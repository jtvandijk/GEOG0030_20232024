<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOG0030</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-data.html" rel="next">
<link href="./06-operations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="assets/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-operations.html">Core Spatial Analysis</a></li><li class="breadcrumb-item"><a href="./07-autocorrelation.html">Analysing Spatial Patterns II: Spatial Autocorrelation</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jtvandijk/GEOG0030" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Module overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Foundational Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 Geocomputation: An Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-GIScience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 GIScience and GIS software</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-cartography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 Cartography and Visualisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 Programming for Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Programming for Spatial Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Core Spatial Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 Analysing Spatial Patterns I: Geometric Operations and Spatial Queries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-autocorrelation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">7 Analysing Spatial Patterns II: Spatial Autocorrelation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Advanced Spatial Analysis</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Additional Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Data Sources</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analysing-spatial-patterns-ii-spatial-autocorrelation" id="toc-analysing-spatial-patterns-ii-spatial-autocorrelation" class="nav-link active" data-scroll-target="#analysing-spatial-patterns-ii-spatial-autocorrelation"><span class="header-section-number">7</span> Analysing Spatial Patterns II: Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#slides-w07" id="toc-slides-w07" class="nav-link" data-scroll-target="#slides-w07"><span class="header-section-number">7.1</span> Lecture slides</a></li>
  <li><a href="#reading-w07" id="toc-reading-w07" class="nav-link" data-scroll-target="#reading-w07"><span class="header-section-number">7.2</span> Reading list</a></li>
  <li><a href="#clustering-of-population-groups" id="toc-clustering-of-population-groups" class="nav-link" data-scroll-target="#clustering-of-population-groups"><span class="header-section-number">7.3</span> Clustering of population groups</a>
  <ul class="collapse">
  <li><a href="#setup-w07" id="toc-setup-w07" class="nav-link" data-scroll-target="#setup-w07"><span class="header-section-number">7.3.1</span> Spatial analysis set up</a></li>
  <li><a href="#data-preparation-w07" id="toc-data-preparation-w07" class="nav-link" data-scroll-target="#data-preparation-w07"><span class="header-section-number">7.3.2</span> Data preparation</a></li>
  </ul></li>
  <li><a href="#statistical-distributions" id="toc-statistical-distributions" class="nav-link" data-scroll-target="#statistical-distributions"><span class="header-section-number">7.4</span> Statistical distributions</a></li>
  <li><a href="#spatial-distributions" id="toc-spatial-distributions" class="nav-link" data-scroll-target="#spatial-distributions"><span class="header-section-number">7.5</span> Spatial distributions</a></li>
  <li><a href="#spatial-autocorrelation" id="toc-spatial-autocorrelation" class="nav-link" data-scroll-target="#spatial-autocorrelation"><span class="header-section-number">7.6</span> Spatial autocorrelation</a>
  <ul class="collapse">
  <li><a href="#spatial-lag" id="toc-spatial-lag" class="nav-link" data-scroll-target="#spatial-lag"><span class="header-section-number">7.6.1</span> Spatial lag</a></li>
  <li><a href="#defining-neighbours" id="toc-defining-neighbours" class="nav-link" data-scroll-target="#defining-neighbours"><span class="header-section-number">7.6.2</span> Defining neighbours</a></li>
  <li><a href="#spatial-weights-matrix" id="toc-spatial-weights-matrix" class="nav-link" data-scroll-target="#spatial-weights-matrix"><span class="header-section-number">7.6.3</span> Spatial weights matrix</a></li>
  <li><a href="#global-morans-i" id="toc-global-morans-i" class="nav-link" data-scroll-target="#global-morans-i"><span class="header-section-number">7.6.4</span> Global Moran’s I</a></li>
  </ul></li>
  <li><a href="#wm-w07" id="toc-wm-w07" class="nav-link" data-scroll-target="#wm-w07"><span class="header-section-number">7.7</span> Want more? [Optional]</a>
  <ul class="collapse">
  <li><a href="#more-spatial-autocorrelation" id="toc-more-spatial-autocorrelation" class="nav-link" data-scroll-target="#more-spatial-autocorrelation">More spatial autocorrelation</a></li>
  </ul></li>
  <li><a href="#byl-w07" id="toc-byl-w07" class="nav-link" data-scroll-target="#byl-w07"><span class="header-section-number">7.8</span> Before you leave</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jtvandijk/GEOG0030/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="analysing-spatial-patterns-ii-spatial-autocorrelation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">7</span> Analysing Spatial Patterns II: Spatial Autocorrelation</h1>
<p>This week, we will be looking at measuring spatial dependence. Spatial dependence is the idea that the observed value of a variable in one location is dependent (to some degree) on the observed value of the same value in a nearby location. For spatial analysis, this dependence can be assessed and measured statistically by considering the level of spatial autocorrelation between values of a specific variable, observed in either different locations or between pairs of variables observed at the same location. Spatial autocorrelation occurs when these values are not independent of one another and instead cluster together across geographic space.</p>
<section id="slides-w07" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="slides-w07"><span class="header-section-number">7.1</span> Lecture slides</h2>
<p>The slides for this week’s lecture can be downloaded here: <a href="https://github.com/jtvandijk/GEOG0030/tree/master/slides/w07-geo.pdf">[Link]</a></p>
</section>
<section id="reading-w07" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="reading-w07"><span class="header-section-number">7.2</span> Reading list</h2>
<section id="essential-readings" class="level4">
<h4 class="anchored" data-anchor-id="essential-readings">Essential readings</h4>
<ul>
<li>Griffith, D. 2017. <em>Spatial Autocorrelation</em>. The Geographic Information Science &amp; Technology Body of Knowledge. <a href="https://doi.org/10.22224/gistbok/2020.3.10">[Link]</a></li>
<li>Gimond, M. 2023. Intro to GIS and spatial analysis. <strong>Chapter 13</strong>: <em>Spatial autocorrelation</em>. <a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">[Link]</a></li>
<li>Livings, M. and Wu, A-M. 2020. <em>Local Measures of Spatial Association</em>. The Geographic Information Science &amp; Technology Body of Knowledge. <a href="https://doi.org/10.22224/gistbok/2020.3.10">[Link]</a></li>
</ul>
</section>
<section id="suggested-readings" class="level4">
<h4 class="anchored" data-anchor-id="suggested-readings">Suggested readings</h4>
<ul>
<li>Lee, S. 2019. Uncertainty in the effects of the modifiable areal unit problem under different levels of spatial autocorrelation: a simulation study. <em>International Journal of Geographical Information Science</em> 33: 1135-1154. <a href="https://doi.org/10.1080/13658816.2018.1542699">[Link]</a></li>
<li>Harris, R. 2020. Exploring the neighbourhood-level correlates of Covid-19 deaths in London using a difference across spatial boundaries method. <em>Health &amp; Place</em> 66: 102446. <a href="https://doi.org/10.1016/j.healthplace.2020.102446">[Link]</a></li>
</ul>
</section>
</section>
<section id="clustering-of-population-groups" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="clustering-of-population-groups"><span class="header-section-number">7.3</span> Clustering of population groups</h2>
<p>This week, we are using a completely new dataset and investigating a different phenomena: <strong>clustering of different population groups</strong>. We will be investigating to what extent people in London who <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/culturalidentity/ethnicity/bulletins/ethnicgroupenglandandwales/census2021">self-identified</a> as <strong>Asian - Bangladeshi</strong> in the 2021 Census are clustered in London at the Ward-level.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The Wards and electoral divisions in the United Kingdom are electoral districts at sub-national level. These differ from the Census geographies (LSOAs, MSOAs) we have been using so far.</p>
</div>
</div>
</div>
<p>To complete this analysis, we will be using a single data download from the <a href="https://data.london.gov.uk/">London Datastore</a>, which we will need to clean and join to a spatial layer containing the relevant Ward boundaries.</p>
<section id="setup-w07" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="setup-w07"><span class="header-section-number">7.3.1</span> Spatial analysis set up</h3>
<p>Open a new script within your GEOG0030 project and save this script as <code>wk6-segregation-analysis.r</code>. At the top of your script, add the following metadata:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/06-script-title_ab25eb3e1520bef3285084fc60f4a970">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysing segregation in London </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Date: January 2024</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Justin </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Now let us add all of the libraries we will be using today to the top of our script:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/06-load-libraries_62196407533eb5d871f61a3f7d26b25e">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We will start by downloading the 2022 Ward boundaries for Great Britain:</p>
<ol type="1">
<li>Navigate to the <em>Open Geography Portal</em>: <a href="https://geoportal.statistics.gov.uk/">[Link]</a></li>
<li>In the main menu go to <strong>Boundaries</strong> -&gt; <strong>Administrative Boundaries </strong> -&gt; <strong>Wards / Electoral Divisions</strong> -&gt; <strong>2022 Boundaries</strong>.</li>
<li>Click on <strong>Wards (December 2022) Boundaries GB GBC</strong>.</li>
<li>Click on <strong>Download</strong> -&gt; <strong>Download GeoPackage</strong>.</li>
<li>Save the file as <code>WARDS2022.gpkg</code> in your <code>boundaries</code> folder.</li>
</ol>
<p>For the data on ethnic groups we turn to the <a href="https://data.london.gov.uk/about/">London Datastore</a> again. They have prepared just the dataset that we want to use from the 2021 Census.</p>
<ol type="1">
<li>Navigate to the London Datastore: <a href="https://data.london.gov.uk/">[Link]</a>.</li>
<li>Click on <strong>Data</strong> in the navigation menu.</li>
<li>Type <em>2021 census Wards ethnicity</em> into the search field.</li>
<li>Download the <code>Ethnic group.xlsx</code> file containing Ward codes and counts of number of individuals who self-identify with a particular population group.</li>
</ol>
<p>Open de file in Excel, and look at the first tab (<strong>Front Page</strong>). You will notice that under <strong>Geography</strong> 2022 Wards are listed. This is good because these are the ones we just downloaded. The actual data that we want to use can be found on the <strong>2021</strong> tab, which contains the 2021 Census results.</p>
<div class="cell" data-hash="07-autocorrelation_cache/html/fig-ethnic-excel_0555d6c19284c02f1b8c70fe6aa1b7e1">
<div class="cell-output-display">
<div id="fig-ethnic-excel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/ethnic-groups.png" class="img-fluid figure-img" width="776"></p>
<figcaption class="figure-caption">Figure&nbsp;1: The Excel file containing the number of people that self-identify as a particular group by Ward. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/ethnic-groups.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>We clearly need to extract the data and save this as a separate <code>csv</code> file before we can import the data into R.</p>
<ol type="1">
<li>Open a new Excel spreadsheet.</li>
<li>From the <strong>2021</strong> tab of the <code>Ethnic group.xlsx</code> spreadsheet, cut (<strong>Edit</strong> -&gt; <strong>Cut</strong>) all cells from columns <strong>A</strong> to <strong>X</strong> and rows <strong>1 to 681</strong> and paste these into this new spreadsheet.</li>
<li>Save the file as <code>csv</code> into your <code>data</code> folder as <code>WARD2021_ethnic_group.csv</code>.</li>
</ol>
<p>After this, let’s load our London MSOA file:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-load-shp_85a451d9cc31bed1fa39feba887c3cb8">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our Ward GeoPackage</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ward_gb <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/raw/boundaries/WARDS2022.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `WD_DEC_22_GB_BGC' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0030/data/raw/boundaries/WARDS2022.gpkg' 
  using driver `GPKG'
Simple feature collection with 8021 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 5512.998 ymin: 5352.6 xmax: 655653.8 ymax: 1220299
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
</div>
<p>Check the <strong>CRS</strong> of our <code>ward_gb</code> spatial dataframe:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-crs-wardshp_c6b3f76120850a1aa0b3d64fd008fd29">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect CRS</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(ward_gb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: OSGB36 / British National Grid 
  wkt:
PROJCRS["OSGB36 / British National Grid",
    BASEGEOGCRS["OSGB36",
        DATUM["Ordnance Survey of Great Britain 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["United Kingdom (UK) - offshore to boundary of UKCS within 49°45'N to 61°N and 9°W to 2°E; onshore Great Britain (England, Wales and Scotland). Isle of Man onshore."],
        BBOX[49.75,-9,61.01,2.01]],
    ID["EPSG",27700]]</code></pre>
</div>
</div>
<p>This all looks good, so we can move to also load the <code>csv</code> we just created:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-ethnicity-csv_893fbc2fd0bad3fc3f98290cfefe693f">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read csv</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ethnicity_london <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/data/WARD2021_ethnic_group.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 680 Columns: 24
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(4): ward code, ward name, local authority code, local authority name dbl (19):
All usual residents, White British, White Irish, White Gypsy/Irish... lgl (1):
...9
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...9`</code></pre>
</div>
</div>
<p>Inspect the file by using the <code>View()</code> function. First thing you will notice is that the column names are rather long. Second thing you will notice is that one of the columns does not contain any information but <code>NA</code> values. It also does not have a meaningful name (<code>...9</code>), and it seems that in the process of saving the <code>csv</code> an extra column was added by Excel in the conversion. Let’s drop this column, and any other columns we do not need, first and then rename the remaining columns.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>If your conversion from Excel to <code>csv</code> did not result in an extra column, update the code below to reflect this so to avoid dropping a column that contains information.</p>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-drop-rename-cols_776e17a91575ed2f40b0df1f7cd1adb3">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop columns by index</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ethnicity_london <span class="ot">&lt;-</span> ethnicity_london <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">9</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rename columns</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ethnicity_london) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ward22cd"</span>, <span class="st">"ward22nm"</span>, <span class="st">"all_pop"</span>, <span class="st">"white_british"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"white_irish"</span>, <span class="st">"white_gypsy"</span>, <span class="st">"white_other"</span>, <span class="st">"mixed_white_asian"</span>, <span class="st">"mixed_white_african"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mixed_white_caribbean"</span>, <span class="st">"mixed_other"</span>, <span class="st">"asian_bangladeshi"</span>, <span class="st">"asian_chinese"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"asian_indian"</span>, <span class="st">"asian_pakistani"</span>, <span class="st">"asian_other"</span>, <span class="st">"black_african"</span>, <span class="st">"black_caribbean"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"black_other"</span>, <span class="st">"other_arab"</span>, <span class="st">"other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>If you like, you can also write out the final <code>csv</code> using the <code>write_csv()</code> function.</p>
</section>
<section id="data-preparation-w07" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="data-preparation-w07"><span class="header-section-number">7.3.2</span> Data preparation</h3>
<p>We now need to join our population group dataset to our Ward spatial layer. Because the Ward dataset contains every the geometry of every single Ward in Great Britain, we can use an <code>inner_join</code> so that only the geometries of those Wards that also appear in the <code>ethnicity_london</code> object are retained.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-join-pop-shp_153b0f079f47681bc3386c80a86dd45f">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inner join</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ethnicity_london_sdf <span class="ot">&lt;-</span> ward_gb <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ethnicity_london, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"WD22CD"</span> <span class="ot">=</span> <span class="st">"ward22cd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Have a look at your newly created Ward dataframe using the <code>plot()</code> function.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-quick-plt_33f6cc21578cd17fcbbd2b20f68e8efc">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ethnicity_london_sdf, <span class="at">max.plot =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-quick-plt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-quick-plt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Quick plot of the filtered Ward spatial dataframe.</figcaption>
</figure>
</div>
</div>
</div>
<p>This is looking reasonably okay, however, it is clear that there are some data missing from the <a href="https://en.wikipedia.org/wiki/City_of_London">City of London</a>. The reason for this is that the dataset we downloaded only contains an overall value for the City of London not a value for every individual Ward. If we only were interested in plotting some data, we could simply add a layer with <strong>no data</strong> to colour in the empty City of London area, but for measuring spatial autocorrelation it is essential that there are no holes in the spatial data that should not be there. We will fix this by extracting the Wards pertaining to the City of London and adding these to our spatial dataframe.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-city-of-london_97fff06b7c020a6d7e6fb0ebbac30ecf">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter Wards pertaining to City of London</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>city_of_london_sdf <span class="ot">&lt;-</span> ward_gb <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(LAD22NM <span class="sc">==</span> <span class="st">"City of London"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We have effectively taken out the <strong>25</strong> 2022 Wards that fall with in the City of London Local Authority District. We now need to assign our ethnic group data to this. We will add the data and equally divide the counts across the Wards.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This is a bit of a lazy approach. Much better would be to actually try and find the actual Ward counts from the 2021 Census.</p>
</div>
</div>
</div>
<p>To join the <code>ethnicity_london</code> dataset to the City of London wards is a bit tricky — because the dataset does not contain the actual Wards codes. Fortunately for us, the London Data Store was a bit cheeky and in the file they created they put the Local Authority District code of the City of London into the Ward column. We can use this to join our datasets together with <code>left_join</code>.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-join-city-shp_35b6cbeb5463d8bb3e3c99ee4e80c618">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inner join</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>city_of_london_sdf <span class="ot">&lt;-</span> city_of_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ethnicity_london, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"LAD22CD"</span> <span class="ot">=</span> <span class="st">"ward22cd"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(city_of_london_sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 31 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 531866.1 ymin: 180540.4 xmax: 533617.7 ymax: 182084.5
Projected CRS: OSGB36 / British National Grid
     WD22CD       WD22NM WD22NMW   LAD22CD        LAD22NM  BNG_E  BNG_N
1 E05009288   Aldersgate         E09000001 City of London 532169 181721
2 E05009289      Aldgate         E09000001 City of London 533397 181175
3 E05009290    Bassishaw         E09000001 City of London 532438 181495
4 E05009291 Billingsgate         E09000001 City of London 533151 180754
5 E05009292  Bishopsgate         E09000001 City of London 533207 181664
6 E05009293 Bread Street         E09000001 City of London 532224 181151
      LONG     LAT Shape_Leng                               GlobalID
1 -0.09645 51.5190   1726.380 {E218C4C6-CC77-423C-9312-010363F61625}
2 -0.07896 51.5138   1895.285 {E968A26F-9AF6-460A-A075-7F8AB975CB16}
3 -0.09266 51.5169   1428.356 {8B433738-7452-4891-A3B0-17498C13F8AD}
4 -0.08267 51.5100   1670.199 {7FF90094-80A5-466D-AE07-B30EC9966CCC}
5 -0.08152 51.5182   2748.846 {DBE8B6D5-0C08-4FB5-9C36-D2F7483B4792}
6 -0.09587 51.5138   2082.841 {1EC7A9B3-EAB0-4CC5-8627-354BA7865D6C}
                     ward22nm all_pop white_british white_irish white_gypsy
1 City of London (aggregated)    7375          4243         180           3
2 City of London (aggregated)    7375          4243         180           3
3 City of London (aggregated)    7375          4243         180           3
4 City of London (aggregated)    7375          4243         180           3
5 City of London (aggregated)    7375          4243         180           3
6 City of London (aggregated)    7375          4243         180           3
  white_other mixed_white_asian mixed_white_african mixed_white_caribbean
1        1373               111                  37                    38
2        1373               111                  37                    38
3        1373               111                  37                    38
4        1373               111                  37                    38
5        1373               111                  37                    38
6        1373               111                  37                    38
  mixed_other asian_bangladeshi asian_chinese asian_indian asian_pakistani
1         103               232           263          216              16
2         103               232           263          216              16
3         103               232           263          216              16
4         103               232           263          216              16
5         103               232           263          216              16
6         103               232           263          216              16
  asian_other black_african black_caribbean black_other other_arab other
1         213            98              46          49         69    85
2         213            98              46          49         69    85
3         213            98              46          49         69    85
4         213            98              46          49         69    85
5         213            98              46          49         69    85
6         213            98              46          49         69    85
                           SHAPE
1 MULTIPOLYGON (((532248.7 18...
2 MULTIPOLYGON (((533466.1 18...
3 MULTIPOLYGON (((532536.2 18...
4 MULTIPOLYGON (((533320.1 18...
5 MULTIPOLYGON (((533404.6 18...
6 MULTIPOLYGON (((532025 1813...</code></pre>
</div>
</div>
<p>This seems to have worked quite nicely, except that now all our data points have been duplicated. We need to fix this by dividing all counts by 25 (the number of wards) to equally divide the counts across the City of London. If we have to do this for every column individually there is a lot of typing involved, but fortunately we can use the <code>mutate_at()</code> function from the <code>dplyr</code> library to do this for the columns in one go. You can use the <code>names()</code> function to identify the columns you need to divide by 25.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Check the documentation of the <code>mutate_at()</code> function to see how it works in detail, but essentially you provide a function, in this case “divide a number by the total number of Wards” and do this for all columns that are specified.</p>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-city-of-london-divvie-up_41320e3b653b0b26fb477f4e8b3d86be">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># divide counts by Wards</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>city_of_london_sdf <span class="ot">&lt;-</span> city_of_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="dv">13</span><span class="sc">:</span><span class="dv">31</span>), <span class="cf">function</span>(x) <span class="fu">as.integer</span>(x<span class="sc">/</span><span class="fu">nrow</span>(city_of_london_sdf)))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(city_of_london_sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 31 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 531866.1 ymin: 180540.4 xmax: 533617.7 ymax: 182084.5
Projected CRS: OSGB36 / British National Grid
     WD22CD       WD22NM WD22NMW   LAD22CD        LAD22NM  BNG_E  BNG_N
1 E05009288   Aldersgate         E09000001 City of London 532169 181721
2 E05009289      Aldgate         E09000001 City of London 533397 181175
3 E05009290    Bassishaw         E09000001 City of London 532438 181495
4 E05009291 Billingsgate         E09000001 City of London 533151 180754
5 E05009292  Bishopsgate         E09000001 City of London 533207 181664
6 E05009293 Bread Street         E09000001 City of London 532224 181151
      LONG     LAT Shape_Leng                               GlobalID
1 -0.09645 51.5190   1726.380 {E218C4C6-CC77-423C-9312-010363F61625}
2 -0.07896 51.5138   1895.285 {E968A26F-9AF6-460A-A075-7F8AB975CB16}
3 -0.09266 51.5169   1428.356 {8B433738-7452-4891-A3B0-17498C13F8AD}
4 -0.08267 51.5100   1670.199 {7FF90094-80A5-466D-AE07-B30EC9966CCC}
5 -0.08152 51.5182   2748.846 {DBE8B6D5-0C08-4FB5-9C36-D2F7483B4792}
6 -0.09587 51.5138   2082.841 {1EC7A9B3-EAB0-4CC5-8627-354BA7865D6C}
                     ward22nm all_pop white_british white_irish white_gypsy
1 City of London (aggregated)     295           169           7           0
2 City of London (aggregated)     295           169           7           0
3 City of London (aggregated)     295           169           7           0
4 City of London (aggregated)     295           169           7           0
5 City of London (aggregated)     295           169           7           0
6 City of London (aggregated)     295           169           7           0
  white_other mixed_white_asian mixed_white_african mixed_white_caribbean
1          54                 4                   1                     1
2          54                 4                   1                     1
3          54                 4                   1                     1
4          54                 4                   1                     1
5          54                 4                   1                     1
6          54                 4                   1                     1
  mixed_other asian_bangladeshi asian_chinese asian_indian asian_pakistani
1           4                 9            10            8               0
2           4                 9            10            8               0
3           4                 9            10            8               0
4           4                 9            10            8               0
5           4                 9            10            8               0
6           4                 9            10            8               0
  asian_other black_african black_caribbean black_other other_arab other
1           8             3               1           1          2     3
2           8             3               1           1          2     3
3           8             3               1           1          2     3
4           8             3               1           1          2     3
5           8             3               1           1          2     3
6           8             3               1           1          2     3
                           SHAPE
1 MULTIPOLYGON (((532248.7 18...
2 MULTIPOLYGON (((533466.1 18...
3 MULTIPOLYGON (((532536.2 18...
4 MULTIPOLYGON (((533320.1 18...
5 MULTIPOLYGON (((533404.6 18...
6 MULTIPOLYGON (((532025 1813...</code></pre>
</div>
</div>
<p>That is much better. The last thing we now need to do is to combine our <code>city_of_london_sdf</code> with our <code>ethnicity_london_sdf</code>. Because both spatial dataframe contain the exact same data and column names, we can simply <strong>bind</strong> them together.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-city-of-london-bind_47204963256dfb2f25e8fad54fe54b06">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bind spatial dataframes</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ethnicity_london_sdf <span class="ot">&lt;-</span> ethnicity_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(city_of_london_sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Let’s check whether our approach worked by plotting the updated spatial dataframe:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-quick-plt-again_ba94a30dcba002f009b105069ef2913a">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ethnicity_london_sdf, <span class="at">max.plot =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-quick-plt-again" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-quick-plt-again-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Quick plot of the full Ward spatial dataframe.</figcaption>
</figure>
</div>
</div>
</div>
<p>This looks much better: there are no more obvious holes in our spatial dataframe and we can move on.</p>
</section>
</section>
<section id="statistical-distributions" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="statistical-distributions"><span class="header-section-number">7.4</span> Statistical distributions</h2>
<p>Today, we are interested in looking at spatial autocorrelation: the effect of spatial processes on distributions. We will be using our newly created <code>ethnicity_london_sdf</code> to look at this in action.</p>
<p>Within general data analysis, when it comes to analysing the distribution of your data, you are looking to conduct what is known as <strong>Exploratory Data Analysis</strong> (EDA) which is where we look to summarise the main characteristics of our data. EDA was promoted by prominent statistician <a href="https://en.wikipedia.org/wiki/John_Tukey">John Tukey</a> to encourage data analysts to explore their data outside of traditional formal modelling and come up with new areas of investigation and hypotheses. Tukey promoted the use of five summary statistics: the <strong>maximum</strong>, the <strong>minimum</strong>, the <strong>median</strong>, and the <strong>quartiles</strong>, which, in comparison to the mean and standard deviation, provide a more robust understanding of a data’s distribution, particularly if the data is skewed.</p>
<p>We looked at how we can use R to extract some of these summary statistics briefly in <a href="04-statistics.html#atomic-vectors">Week 4’s computer tutorial</a>, but let’s have a look at how we can add further to this EDA, including creating some statistical charts of our data’s distribution. A simple and straightforward way is by using the <code>summary()</code> function.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>summary()</code> function can be called on a dataset as a whole and will generate summary statistics for each numeric variable.</p>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-summarise-sdf_93f5d2bfe261f6e3b7836cfcfff44c32">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise dataframe, but exclude geometry column</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ethnicity_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    WD22CD             WD22NM            WD22NMW            LAD22CD         
 Length:704         Length:704         Length:704         Length:704        
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   LAD22NM              BNG_E            BNG_N             LONG         
 Length:704         Min.   :505661   Min.   :157756   Min.   :-0.47645  
 Class :character   1st Qu.:523789   1st Qu.:174575   1st Qu.:-0.21930  
 Mode  :character   Median :531040   Median :181022   Median :-0.11311  
                    Mean   :530499   Mean   :180206   Mean   :-0.12106  
                    3rd Qu.:537483   3rd Qu.:186252   3rd Qu.:-0.02262  
                    Max.   :557943   Max.   :199291   Max.   : 0.27621  
      LAT          Shape_Leng        GlobalID           ward22nm        
 Min.   :51.30   Min.   :  965.1   Length:704         Length:704        
 1st Qu.:51.46   1st Qu.: 4888.3   Class :character   Class :character  
 Median :51.51   Median : 6496.1   Mode  :character   Mode  :character  
 Mean   :51.51   Mean   : 7213.4                                        
 3rd Qu.:51.56   3rd Qu.: 8619.1                                        
 Max.   :51.68   Max.   :35083.0                                        
    all_pop      white_british    white_irish    white_gypsy    
 Min.   :   51   Min.   :   10   Min.   :   1   Min.   :  0.00  
 1st Qu.: 9641   1st Qu.: 3102   1st Qu.: 148   1st Qu.:  3.00  
 Median :11712   Median : 4854   Median : 227   Median :  8.00  
 Mean   :11611   Mean   : 5212   Mean   : 250   Mean   : 11.63  
 3rd Qu.:14467   3rd Qu.: 7077   3rd Qu.: 323   3rd Qu.: 14.00  
 Max.   :21292   Max.   :14727   Max.   :1345   Max.   :216.00  
  white_other     mixed_white_asian mixed_white_african mixed_white_caribbean
 Min.   :  11.0   Min.   :  0.0     Min.   :  1.0       Min.   :  1.00       
 1st Qu.: 767.5   1st Qu.:101.0     1st Qu.: 48.0       1st Qu.: 85.75       
 Median :1299.5   Median :142.0     Median : 79.0       Median :140.00       
 Mean   :1468.7   Mean   :144.2     Mean   : 93.0       Mean   :169.62       
 3rd Qu.:2057.2   3rd Qu.:185.2     3rd Qu.:125.2       3rd Qu.:223.00       
 Max.   :4708.0   Max.   :442.0     Max.   :403.0       Max.   :800.00       
  mixed_other    asian_bangladeshi asian_chinese     asian_indian   
 Min.   :  1.0   Min.   :   3.0    Min.   :   0.0   Min.   :   3.0  
 1st Qu.:109.0   1st Qu.:  42.0    1st Qu.:  83.0   1st Qu.: 191.0  
 Median :158.5   Median :  92.5    Median : 140.5   Median : 323.5  
 Mean   :168.8   Mean   : 315.5    Mean   : 176.5   Mean   : 771.1  
 3rd Qu.:225.2   3rd Qu.: 201.0    3rd Qu.: 214.2   3rd Qu.: 765.2  
 Max.   :469.0   Max.   :6852.0    Max.   :1344.0   Max.   :7763.0  
 asian_pakistani   asian_other     black_african    black_caribbean 
 Min.   :   0.0   Min.   :   1.0   Min.   :   3.0   Min.   :   1.0  
 1st Qu.:  60.0   1st Qu.: 251.8   1st Qu.: 278.8   1st Qu.: 132.5  
 Median : 120.5   Median : 430.5   Median : 569.0   Median : 286.0  
 Mean   : 317.9   Mean   : 566.0   Mean   : 815.2   Mean   : 489.5  
 3rd Qu.: 331.8   3rd Qu.: 712.8   3rd Qu.:1123.8   3rd Qu.: 676.2  
 Max.   :3633.0   Max.   :3225.0   Max.   :5297.0   Max.   :3523.0  
  black_other       other_arab          other       
 Min.   :   1.0   Min.   :   1.00   Min.   :   0.0  
 1st Qu.:  65.0   1st Qu.:  46.75   1st Qu.: 112.0  
 Median : 174.0   Median :  91.00   Median : 199.0  
 Mean   : 241.6   Mean   : 150.59   Mean   : 248.6  
 3rd Qu.: 339.0   3rd Qu.: 169.00   3rd Qu.: 339.8  
 Max.   :1563.0   Max.   :1693.00   Max.   :1411.0  </code></pre>
</div>
</div>
<p>This gives us an overview of all variables, but let’s have a look at our population group of interest for today’s practical by creating a <a href="https://en.wikipedia.org/wiki/Histogram">histogram</a>.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-quick-hist_17d56e1ebb6841adea3925d334c6164c">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ethnicity_london_sdf<span class="sc">$</span>asian_bangladeshi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-quick-hist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-quick-hist-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Histogram of the distribution of the self-identified Asian-Bangladeshi population group.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can actually see our data has a strong negative skew, with a some Wards having a high number of self-identified Asian-Bangladeshi’s residing in them. This might be a first hint at some form of clustering taking place.</p>
<p>Another type of chart we can create just using the <code>base</code> R library is a <strong>boxplot</strong>. A boxplot shows the core characteristics of the distributions within a dataset, including the interquartile range.</p>
<div class="cell" data-hash="07-autocorrelation_cache/html/fig-boxplot_3568fd7dfad8de5a8dd84764672709d1">
<div class="cell-output-display">
<div id="fig-boxplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/boxplot.png" class="img-fluid figure-img" width="2000"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Simple boxplot. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/boxplot.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>Plot the boxplot of our <code>asian_bangladeshi</code> variable:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-quick-boxplot_858d499942b584914203c6756ad36bcc">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(ethnicity_london_sdf<span class="sc">$</span>asian_bangladeshi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-quick-boxplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-quick-boxplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Boxplot of the distribution of the self-identified Asian-Bangladeshi population group.</figcaption>
</figure>
</div>
</div>
</div>
<p>Again, it is clear that the majority of Wards have a relatively low nuber of individuals that self-identify as Asian-Bangladeshi, but there is a good number of outliers. This raises the question whether these outliers are random or also clustered in space.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>There is actually a lot more we can do in terms of visualising our data’s distribution and the best way forward would be to become more familiar with the <code>ggplot2</code> library. <code>ggplot2</code> is the main visualisation for both statistical and, increasingly, spatial graphs, charts and maps. Refer back to <a href="04-statistics.html#wm-w04">Week 4’s optional suggestions</a> on how to start with <code>ggplot2</code>.</p>
</div>
</div>
</div>
</section>
<section id="spatial-distributions" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="spatial-distributions"><span class="header-section-number">7.5</span> Spatial distributions</h2>
<p>Whilst statistical analysis of distributions focus on tests and charts, when we want to understand the spatial distribution of our phenomena, we have a very simple solution: we make a map. In our case, we are looking at areal unit data and therefore we can use a choropleth map to study our data across the Wards. In fact, we can actually create a sequence of maps not only covering the self-identified Asian-Bangladeshi’s but also other population groups.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-facet-map_3f35e2e21f3c66f0306716084a418536">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store variables of interest as separate variable</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>var_fields <span class="ot">&lt;-</span> <span class="fu">names</span>(ethnicity_london_sdf)[<span class="dv">14</span><span class="sc">:</span><span class="dv">31</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># map all our variables of interest at once</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ethnicity_london_sdf) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add Ward boundaries</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"gray"</span>, <span class="at">border.col =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(ethnicity_london_sdf) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add all variables of interest</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> var_fields) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add layout options</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.show =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add 4 columns</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">ncol =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-facet-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-facet-map-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Facet map of all our population groups.</figcaption>
</figure>
</div>
</div>
</div>
<p>Despite these maps being a little small and not containing any labels, it seems that different population groups indeed concentrate in different parts of London. Let’s zoom into the Asian-Bangladeshi population group and add a legend:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-facet-map-asian-bangladeshi_68831c444e7d274794d774dcf69bb6f6">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map a specific variable</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ethnicity_london_sdf) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"gray"</span>, <span class="at">border.col =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(ethnicity_london_sdf) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"asian_bangladeshi"</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">"jenks"</span>) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.outside.position =</span> <span class="st">"right"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>), <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-facet-map-asian-bangladeshi" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-facet-map-asian-bangladeshi-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Quick map of the self-identified Asian-Bangladeshi population group.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Please remember, whereas the above map is fine for a quick inspection, it is technically incorrect because we are showing absolute numbers on a choropleth. This is something we should never do, unless the spatial units are identical in size (e.g.&nbsp;a hexagonal tessellation of an area), because larger areas will draw attention and affect the visualisation. To be fair, even for a quick inspection, it would be much better to normalise these counts by the total number of people living within each of the Wards to get a more honoust picture of the distribution.</p>
</div>
</div>
</div>
<p>The thing with spatial distributions is that we can quickly pick up on spatial patterns present within our data just by looking at the data. For example, we can clearly see some concentrations of people that self-identify as Asian-Bangladeshi’s in East London. The question now is whether these clusters are significant from a statistical point of view. This brings us to measuring spatial correlation.</p>
</section>
<section id="spatial-autocorrelation" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="spatial-autocorrelation"><span class="header-section-number">7.6</span> Spatial autocorrelation</h2>
<p>We can assess the distribution of our data using what is known as spatial autocorrelation tests, which can be conducted on both a global (identify if the data is clustered) and local (identify the precise clusters) scales. Whilst these different tests quantify how clustered, how random, or how dispersed, these distributions are through various approaches, ultimately they provide us with statistical and spatial information that can be used to create quantifiable descriptions of a variable’s distribution and how it vary over space.</p>
<p>As discussed in this week’s lecture, we have several types of tests that look to quantify spatial autocorrelation. Of these tests, there are two main categories:</p>
<ul>
<li>Measures of <strong>global spatial aucorrelation</strong>: tests that provide us with a statistic to tell whether spatial autocorrelation is present in our dataset.</li>
<li>Measures of <strong>local spatial autocorrelation</strong>: tests that break down the global patterns and essentially tell us where we can find clusters and outliers.</li>
</ul>
<p>Three of the most frequently used tests are the Global Moran’s I, the. Local Moran’s I, and the Local Getis-Ord:</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 34%">
<col style="width: 34%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Scale</th>
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Output</th>
<th style="text-align: left;">Significance Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Global Moran’s I</td>
<td style="text-align: left;">Global</td>
<td style="text-align: left;">Tests how “random” the spatial distribution of values are, producing a correlation coefficient for the relationship between a variable (like income) and its surrounding values.</td>
<td style="text-align: left;"><strong>Moran’s I statistic:</strong> <br> Metric between -1 and 1. <br> -1 = dispersed <br> 0 = CSR <br> 1 = clustered</td>
<td style="text-align: left;">Yes - <span class="math inline">\(p\)</span>-value</td>
</tr>
<tr class="even">
<td style="text-align: left;">Local Moran’s I</td>
<td style="text-align: left;">Local</td>
<td style="text-align: left;">Tests the difference between a unit of analysis and its neighbour(s).</td>
<td style="text-align: left;"><strong>Local Moran’s I statistic:</strong> <br> 1. Can be used alongside the mean of values to generate cluster type generations. <br>i.e.&nbsp;High-High, High-Low, Low-High, Low-Low, Insignificant. <br> 2. Can also use standard deviation of main local statistic to show just high and low clusters</td>
<td style="text-align: left;">Yes - <span class="math inline">\(p\)</span>-value</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Local Getis-Ord</td>
<td style="text-align: left;">Local</td>
<td style="text-align: left;">Identifies statistically significant hot spots and cold spots using the local Getis-Ord Gi* statistic.</td>
<td style="text-align: left;">Can use the standard deviation of statistic to identify hot and cold spots</td>
<td style="text-align: left;">Yes - <span class="math inline">\(p\)</span>-value</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In each of these cases, our <span class="math inline">\(p\)</span>-values are pseudo <span class="math inline">\(p\)</span>-values, generated through simulations such as those outlined in the lecture. Our pseudo <span class="math inline">\(p\)</span>-values allow us to interpret our relationships with a level of confidence. If we find that our relationships do not have any significance, then we cannot be confident in presenting them as true results.</p>
</div>
</div>
</div>
<!-- normalise values by total population -->
<section id="spatial-lag" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="spatial-lag"><span class="header-section-number">7.6.1</span> Spatial lag</h3>
<p>Underlying our global Moran’s I test is the concept of a <strong>spatial lag model</strong>. A spatial lag model plots each value against the mean of its neighbours’ values, defined by our selected approach. This creates a scatter plot, from which our Moran’s I statistic can be derived.</p>
<p>An Ordinary Least Squares (OLS) regression is used to fit the data and produce a slope, which determines the Moran’s I statistic:</p>
<div class="cell" data-hash="07-autocorrelation_cache/html/fig-moran-plot_b67d3f8c3ec587458e3cce5027633493">
<div class="cell-output-display">
<div id="fig-moran-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/moran-scatter.png" class="img-fluid figure-img" width="1226"></p>
<figcaption class="figure-caption">Figure&nbsp;9: A spatial lag model - plotting value against the mean of its neighbours. Source: <a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">Manuel Gimond</a>. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/moran-scatter.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>To determine a <span class="math inline">\(p\)</span>-value from our model for global Moran’s I, this spatial lag model is computed multiple times (think hundreds, thousands) but uses a random distribution of neighbouring values to determine different slopes for multiple ways our data <em>could</em> be distributed if our data was distributed randomly. The output of this test is a sampling distribution of Moran’s I values that would confirm a null hypothesis that our values are randomly distributed. These slopes are then compared to compare our <em>observed</em> slope versus our <em>random</em> slopes and identify whether the slope is within the main distribution of these values or an outlier:</p>
<div class="cell" data-hash="07-autocorrelation_cache/html/fig-moran-plot-sig_67ec573ae185a630bca64b71bb194a1e">
<div class="cell-output-display">
<div id="fig-moran-plot-sig" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/mc-sim.png" class="img-fluid figure-img" width="1094"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Determining significance using a Monte Carlo simulation. Source: <a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">Manuel Gimond</a>. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/mc-sim.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>If our slope is an outlier, i.e.&nbsp;not a value we would expect to compute if the data were randomly distributed, we are more confidently able to confirm our slope is reflective of our data’s clustering and is significant. Our <em>pseudo-</em><span class="math inline">\(p\)</span>-values are then computed from our simulation results:</p>
<p><span class="math display">\[
\frac{N_{extreme} + 1}{N + 1}
\]</span></p>
<p>Where <span class="math inline">\({N_{extreme}}\)</span> is the number of simulated Moran’s I values that were more extreme that our observed statistic and <span class="math inline">\({N}\)</span> is the total number of simulations. In the example above, from <a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">Manuel Gimond</a>, only 1 out the 199 simulations was more extreme than the observed local Moran’s I statistic. Therefore <span class="math inline">\({N_{extreme}}\)</span> = 1 , so <span class="math inline">\(p\)</span> is equal to <span class="math inline">\((1+1) / (199 + 1) = 0.01\)</span>. This means that “there is a 1% probability that we would be wrong in rejecting the null hypothesis”. This approach is known as a <strong>Monte Carlo simulation</strong> or permutation bootstrap test.</p>
</section>
<section id="defining-neighbours" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="defining-neighbours"><span class="header-section-number">7.6.2</span> Defining neighbours</h3>
<p>For any spatial autocorrelation test that you want to conduct, you will always need one critical piece of information: <em>how do we define ‘neighbours’ in our dataset to enable the value comparison.</em> Every observation in a dataset will need to have a set of neighbours to which its value is compared. To enable this, we need to determine how many or what type of neighbours should be taken into account for each observation when conducting a spatial autocorrelation test. These ‘neighbouring’ observations can be defined in a multitude of ways, based either on geometry or proximity, and include:</p>
<ul>
<li><strong>Contiguity</strong> neighbours: Queen / Rook</li>
<li><strong>Fixed Distance</strong> neighbours: Euclidean Distance (e.g.&nbsp;within 2km)</li>
<li><strong>(K) Nearest Neighbours</strong>: Certain <em>n</em> number of closest neighbours</li>
</ul>
<div class="cell" data-hash="07-autocorrelation_cache/html/fig-neighbours_257f9479bb9ef3ae4aeb22d11544de10">
<div class="cell-output-display">
<div id="fig-neighbours" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/iffn.png" class="img-fluid figure-img" width="2550"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Different approaches of conceptualising neighbours for spatial autocorrelation measurement: contiguity, fixed distance and nearest neighbours. Source: <a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">Manuel Gimond</a>. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/iffn.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>Depending on the variable you are measuring, the appropriateness of these different types of neighbourhood calculation techniques can change. As a result, how you define neighbours within your dataset will have an impact on the validity and accuracy of spatial analysis. Whatever approach you choose therefore needs to be grounded in particular theory that aims to represent the process and variable investigated.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Have a look at Esri’s Help Documentation on <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/modeling-spatial-relationships.htm#GUID-729B3B01-6911-41E9-AA99-8A4CF74EEE27">Selecting a conceptualization of spatial relationships: Best practices</a> when you come to need to define neighbours yourself for your own analysis.</p>
</div>
</div>
</div>
<p>For our analysis into the clustering of population groups, we will primarily use the <strong>Queen contiguity</strong>. This approach is “<em>effective when polygons are similar in size and distribution, and when spatial relationships are a function of polygon proximity (the idea that if two polygons share a boundary, spatial interaction between them increases)</em>” (<a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/modeling-spatial-relationships.htm#GUID-729B3B01-6911-41E9-AA99-8A4CF74EEE27">Esri, 2024</a>).</p>
</section>
<section id="spatial-weights-matrix" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="spatial-weights-matrix"><span class="header-section-number">7.6.3</span> Spatial weights matrix</h3>
<p>Before we can calculate Moran’s I and any similar statistics, we need to first define our <strong>spatial weights matrix</strong>. This is known mathematically as <span class="math inline">\(W_{ij}\)</span> and this will tell our code which unit neighbours which, according to our neighbour definition. For each neighbour definition, there is a different approach to implementing code to calculate the <span class="math inline">\(W_{ij}\)</span> spatial weights matrix. We will look at three approaches:</p>
<ol type="1">
<li>Creating a Queen <span class="math inline">\(W_{ij}\)</span> spatial weights matrix</li>
<li>Creating a Rook <span class="math inline">\(W_{ij}\)</span> spatial weights matrix</li>
<li>Creating a Fixed Distance <span class="math inline">\(W_{ij}\)</span> spatial weights matrix</li>
</ol>
<p>For either approach, we use a single line of code to create the relevant <span class="math inline">\(W_{ij}\)</span> spatial weights matrix:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-who-is-your-neighbour_2ea7dc15964aa05ef5fbf33a8c7a9a24">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Queens neighbours</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ward_neighbours_queen <span class="ot">&lt;-</span> ethnicity_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">poly2nb</span>(<span class="at">queen =</span> T)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook neigbhours</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>ward_neighbours_rook <span class="ot">&lt;-</span> ethnicity_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">poly2nb</span>(<span class="at">queen =</span> F)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed distance neighbours</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>ward_neighbours_fd <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(<span class="fu">st_geometry</span>(<span class="fu">st_centroid</span>(ethnicity_london_sdf)),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">4000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(ethnicity_london_sdf): st_centroid assumes attributes
are constant over geometries of x</code></pre>
</div>
</div>
<p>Creating our neighbours list through a single line of code, as above, does not really tell us much about the differences between these different definitions. It would be useful to the links between neighbours for our three definitions and visualise their distribution across space. To be able to do this, we will use a few lines of code to generate a visualisation based on mapping the defined connections between the centroids of our Wards.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>A centroid, in its most simplest form is the central point of an areal unit. How this central point is defined can be weighted by different approaches to understanding geometries or by using an additional variable. In our case, our centroids will reflect in the geometric middle point of our Wards.</p>
</div>
</div>
</div>
<p>We can calculate the centroids of our Wards using one of the <strong>geometric</strong> tools from the <code>sf</code> library: <code>sf_centroid()</code>.</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-get-them-centroids_537cb568f255d77dd57eb1473029cb36">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the centroids of all of the Wards in London</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ward_centroid <span class="ot">&lt;-</span> ethnicity_london_sdf <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_centroid</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(ethnicity_london_sdf): st_centroid assumes attributes
are constant over geometries of x</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>We actually already used this function above as the creation of the fixed distance spatial weights matrix requires a point geometry and then calculates which other point geometries are within the specified distance.</p>
</div>
</div>
</div>
<p>Now we have our Ward centroids, we can go ahead and plot the centroids and the defined neighbour connections between them from each of our neighbour definitions. To do so, we will use the <code>plot()</code> function, provide the relationships via our <code>ward_neighbours_*</code> lists and then the geometry associated with these lists from our <code>ward_centroid</code> object:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-plot-them-neighbours-queen_d6cba11b6819ddafc863a4d002b1dee3">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot neighbours: Queen</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ward_neighbours_queen, <span class="fu">st_geometry</span>(ward_centroid), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-plot-them-neighbours-queen" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-plot-them-neighbours-queen-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: 2022 Wards with a <strong>Queen</strong> neighbourhood definition.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-plot-them-neighbours-rook_b0ecf44bab1fdbd99df42a52e3d31883">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot neighbours: Rook</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ward_neighbours_rook, <span class="fu">st_geometry</span>(ward_centroid), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-plot-them-neighbours-rook" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-plot-them-neighbours-rook-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13: 2022 Wards with a <strong>Rook</strong> neighbourhood definition.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-plot-them-neighbours-fixed_756fc7c7371eebfd9879123e6bca5ac0">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot neighbours: Fixed distance</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ward_neighbours_fd, <span class="fu">st_geometry</span>(ward_centroid), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-plot-them-neighbours-fixed" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-plot-them-neighbours-fixed-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;14: 2022 Wards with a <strong>Fixed distance</strong> neighbourhood definition.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In this example we use four kilometres as a distance threshold (i.e.&nbsp;centroids are considered neighbours if they are within three kilometres from one another, however, this is an arbitrary distance. When using a fixed distance make sure you have a good reason to select the distance (e.g.&nbsp;used in a paper that used the same administrative geographies).</p>
</div>
</div>
</div>
<p>When comparing these different maps, we can see that there is definitely a difference in the number of neighbours when we use our different approaches. It seems our fixed distance neighbour conceptualisation has many connections in the centre of London versus areas on the outskirts. We can see that our contiguity approaches provide a more equally distributed connection map, with our Queen conceptualisation having a few more links that our Rook.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Whichever form of neighbours you are using, <strong>always</strong> check the results, especially those of the contiguity based approaches. If the spatial file that you are using is not in good shape (e.g.&nbsp;polygons seem to touch upon visual inspection but actually do not), your results will be compromised.</p>
</div>
</div>
</div>
<p>We can also type the different neighbours objects into the console to find out the total number of non-zero links (i.e.&nbsp;total number of connections) present within the conceptualisation. You should see that Queen has 4022 non-zero links, Rook has 3854 and Fixed Difference has 12462 Whilst this code simply explores these conceptualisations it helps us understand further how our different neighbourhood conceptualisations can ultimately impact our overall analysis.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Remember: the number of links essentially determines the value of the <strong>spatial lag</strong> variable — i.e.&nbsp;the value of a certain variable in comparison with its neighbours.</p>
</div>
</div>
</div>
<p>With our neighbours now defined, we will go ahead and create our final spatial weights objects that will be needed for our spatial autocorrelation code. At the moment, we have our neighbours defined as a <em>list</em> but we need to convert it to a <em>neighbours</em> object using the <code>nb2listw()</code> function:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/07-meeting-the-neigbhours-queen_7e66846c7365207df2d11618aee533ac">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a neighbours list - Queen</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ward_spatial_weights_queen <span class="ot">&lt;-</span> ward_neighbours_queen <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nb2listw</span>(<span class="at">style =</span> <span class="st">"C"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a neighbours list - Rook</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ward_spatial_weights_queen <span class="ot">&lt;-</span> ward_neighbours_rook <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nb2listw</span>(<span class="at">style =</span> <span class="st">"C"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create a neighbours list</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ward_spatial_weights_fd <span class="ot">&lt;-</span> ward_neighbours_fd <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nb2listw</span>(<span class="at">style =</span> <span class="st">"C"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For the fixed distance measure we need to specify an addition parameter (<code>zero.policy</code>). This is because it is possible that there are Wards without <strong>any</strong> neighbour (i.e.&nbsp;there is a Ward with a centroid that is not within our specified distance). This is not ideal, because you would want every unit to have at least one neighbour. We do not need this parameter in case of the contiguity based measures today because every Ward polygon touches at least one other Ward polygon.</p>
</div>
</div>
</div>
</section>
<section id="global-morans-i" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="global-morans-i"><span class="header-section-number">7.6.4</span> Global Moran’s I</h3>
<p>With a Global Moran’s I we test how random the spatial distribution of our values are, producing a global Moran’s statistic from the lag approach explained earlier.</p>
<p>The global Moran’s I statistic is a metric between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>:</p>
<ul>
<li><span class="math inline">\(-1\)</span> suggests a completely even spatial distribution of values</li>
<li><span class="math inline">\(0\)</span> suggests a <em>random</em> distribution</li>
<li><span class="math inline">\(1\)</span> suggests a <em>non-random</em> distribution of clearly defined clusters</li>
</ul>
<p>Before we run our global Moran’s I test, we will first create a spatial lag model plot which looks at each of the values plotted against their spatially lagged values. The graph will show quickly whether we are likely to expect our test to return a positive, zero, or negative statistic:</p>
<div class="cell styled-output" data-hash="07-autocorrelation_cache/html/fig-07-plot-moran-queens_97554332fdab7e616f9cd268371cf1b9">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran's plot</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.plot</span>(ethnicity_london_sdf<span class="sc">$</span>asian_bangladeshi, <span class="at">listw =</span> ward_spatial_weights_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-plot-moran-queens" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-autocorrelation_files/figure-html/fig-07-plot-moran-queens-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;15: Plot of lagged values versus polygon values using the Queen neigbhourhood definition.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see that there is a positive relationship between our <code>asian_bangladeshi</code> variable and the spatially lagged <code>asian_bangladeshi</code> variable, therefore we are expecting our global Moran’s I test to produce a statistic reflective of the slope visible in our scatter plot. Now we can run the global Moran’s I spatial autocorrelation test:</p>
<!-- ```{r 07-run-GMI, warnings=FALSE, message=FALSE, cache=FALSE, tidy=TRUE} -->
<!-- # run the global Moran's I test on our y6_obesity_2014 data -->
<!-- obesity_GMI <- obesity_Ward_sdf %>% pull(y6_obesity_2014) %>% as.vector() %>% moran.test(., Ward_spatial_weights_queen) -->
<!-- # print global Moran's I result -->
<!-- obesity_GMI -->
<!-- ```  -->
<!-- The Moran’s I statistic calculated should be 0.53. With 1 = clustered, 0 = no pattern, -1 = dispersed, this means we can confirm that childhood obesity in London is positively autocorrelated. In other words, childhood obesity does spatially cluster. We can also consider the pseudo $p$-value as a measure of the statistical significance of the model - at < 2.2e-16, which confirm our result is (psuedo) significant. -->
<!-- :::note -->
<!-- **Note** <br/> -->
<!-- Before we run our local spatial autocorrelation tests, let's just take a second to think through what our results have shown. From our global statistical tests, we can confirm that: -->
<!-- * There is clustering in our dataset. -->
<!-- * Similar values are clustering. -->
<!-- * High values are clustering. -->
<!-- We can conclude already that areas of high levels of childhood obesity tend to cluster in the same area. What we do not know yet is **where** these clusters are occurring. To help with this, we need to run our **local** models to identify where these clusters are located. -->
<!-- ::: -->
<!-- ### Local Moran's I -->
<!-- A local Moran's I test deconstructs the global Moran’s I down to its components and then constructs a localized measure of autocorrelation, which can show different cluster types. To run a local Moran's I test, the code again is similar to above: -->
<!-- ```{r 07-local-MI-1, warnings=FALSE, message=FALSE, cache=FALSE, tidy=TRUE} -->
<!-- # run the local Moran's I test on our y6_obesity_2014 data -->
<!-- obesity_LMI <- obesity_Ward_sdf %>% pull(y6_obesity_2014) %>% as.vector() %>% localmoran(., Ward_spatial_weights_queen) -->
<!-- # print the first 5 lines of the local Moran's I statistic output -->
<!-- head(obesity_LMI) -->
<!-- ```  -->

<!-- As you should see, we do not get given a single statistic as per with our global tests, but rather a table of five different statistics that are all related back to each of the Wards in our dataset. -->
<!-- If we look at the help page for the `localmoran` function (run `?localmoran` in your console) we can find out what each of these statistics mean: -->
<!-- | Name | Description | -->
<!-- | :----- | :---------------| -->
<!-- | Ii | Local Moran's I statistic | -->
<!-- | E.Ii | Expectation of local Moran's I statistic | -->
<!-- | Var.Ii | Variance of local Moran's I statistic | -->
<!-- | Z.Ii | Standard deviation of local Moran's I statistic | -->
<!-- | Pr() | $p$-value of local Moran's I statistic | -->
<!-- We therefore have a local Moran's I statistic for each of our Wards, as well as a significance value plus a few other pieces of information that can help us create some maps showing our clusters. To be able to do this, we need to join our local Moran's I output back into our `obesity_Ward_sdf` spatial dataframe, which will then allow us to map these results.  -->
<!-- To create this join, we first **coerce** our local Moran's I output into a dataframe that we then join to our `obesity_Ward_sdf` spatial dataframe using the `mutate()` function from the `dplyr` library. In our case, we do not need to provide an **attribute** to join these two dataframes together as we use the computer's logic to join the data in the order in which it was created: -->
<!-- ```{r 07-local-MI-join, warnings=FALSE, message=FALSE, cache=FALSE, tidy=TRUE} -->
<!-- # coerce obesity_LMI into dataframe -->
<!-- obesity_LMI <- as.data.frame(obesity_LMI) -->
<!-- # update the names for easier reference -->
<!-- names(obesity_LMI) <- c("LMI_Ii", "LMI_eIi", "LMI_varIi", "LMI_zIi", "LMI_sigP") -->
<!-- # join to obesity_Ward_sdf -->
<!-- obesity_Ward_sdf <- obesity_Ward_sdf %>% mutate(obesity_LMI) -->
<!-- ```  -->
<!-- We now have the data we need to plot our local spatial autocorrelation maps. We will first plot the most simple maps to do with our local Moran's I test: the local Moran's I statistic as well as the $p$-values of the local Moran's I statistic. -->
<!-- Map the local Moran's I statistic:  -->
<!-- ```{r 07-map-LMI, warnings=FALSE, message=FALSE, cache=TRUE, tidy='styler'} -->
<!-- # map our local Moran's I statistic  -->
<!-- tm_shape(obesity_Ward_sdf) +  -->
<!--   tm_polygons("LMI_Ii", style = "pretty", midpoint = 0, title = "Local Moran's I statistic") +  -->
<!--   tm_layout(main.title= "Spatial Autocorrelation of Childhood Obesity in London",  -->
<!--             main.title.fontface = 2, fontfamily = "Helvetica",  -->
<!--             legend.outside = TRUE,  -->
<!--             legend.outside.position = "right",  -->
<!--             legend.title.size = 1,  -->
<!--             legend.title.fontface = 2) +  -->
<!--   tm_compass(type = "arrow", position = c("right", "bottom")) +  -->
<!--   tm_scale_bar(breaks = c(0, 5, 10, 15, 20), position = c("left", "bottom")) -->
<!-- ```  -->
<!-- From the map, it is possible to observe the variations in autocorrelation across space. We can interpret that there seems to be a geographic pattern to the autocorrelation. However, it is not possible to understand if these are clusters of high or low values. To be able to interpret this confidently, we also need to know the significance of the patterns we see in our map and therefore need to map the $p$-value of local Moran's I statistic. -->
<!-- Map the $p$-value of local Moran's I statistic: -->
<!-- ```{r 07-map-LMI-p, warnings=FALSE, message=FALSE, cache=TRUE, tidy='styler'} -->
<!-- # significance breaks -->
<!-- breaks <- c(0, 0.05, 0.1, 1) -->
<!-- # colours for our local Moran's I statistic -->
<!-- colours <- c('white', "#a6bddb", "#2b8cbe" ) -->
<!-- # map our local Moran's I statistic  -->
<!-- tm_shape(obesity_Ward_sdf) +  -->
<!--   tm_polygons("LMI_sigP", style = "fixed", breaks = breaks,  -->
<!--               palette = rev(colours), title = "p-value of Local Moran's I stat") +  -->
<!--   tm_layout(main.title = "Spatial Autocorrelation of Childhood Obesity in London",  -->
<!--             main.title.fontface = 2, fontfamily = "Helvetica",  -->
<!--             legend.outside = TRUE,  -->
<!--             legend.outside.position = "right",  -->
<!--             legend.title.size = 1,  -->
<!--             legend.title.fontface = 2) +  -->
<!--   tm_compass(type = "arrow", position = c("right", "bottom")) +  -->
<!--   tm_scale_bar(breaks = c(0, 5, 10, 15, 20), position = c("left", "bottom")) -->
<!-- ```  -->
<!-- Using our significance map, we can interpret the above clusters present in our local Moran's I statistic more confidently. As evident, we do have several clusters that are statistically significant to the $p$-value < 0.05.  -->
<!-- Ideally we would combine these two outputs to see what values cluster together and which clusters are significant. We can do this with a cluster map of our **local Moran's I statistic (Ii)** which will show areas of different types of clusters, including: -->
<!-- * **HIGH-HIGH**: A Ward of high obesity that is also surrounded by other Wards of high obesity. -->
<!-- * **HIGH-LOW**: A Ward of high obesity that is surrounded by Wards of low obesity. -->
<!-- * **LOW-HIGH**: A Ward of low obesity that is surrounded by Wards of high obesity. -->
<!-- * **LOW-LOW**: A Ward of low obesity that is also surrounded by other Wards of low obesity. -->
<!-- * Those areas that have no significant cluster or relationship to the Wards around them. -->
<!-- Our HIGH-HIGH and LOW-LOW will show our clusters, whereas the other two cluster types reveal anomalies in our variable. To create a map that shows this, we need to quantify the relationship each of our Wards have with the Wards around them to determine their cluster type. We do this using their observed value and their local Moran's I statistic and their deviation around their respective means: -->
<!-- * *If a Ward's observed value is higher than the observed mean and it's local Moran's I statistic is higher than the LMI mean*, it is designated as **HIGH-HIGH**. -->
<!-- * *If a Ward's observed value is lower than the observed mean and it's local Moran's I statistic is lower than the LMI mean*, it is designated as **LOW-LOW**. -->
<!-- * *If a Ward's observed value is lower than the observed mean but it's local Moran's I statistic is higher than the LMI mean*, it is designated as **LOW-HIGH**. -->
<!-- * *If a Ward's observed value is higher than the observed mean but it's local Moran's I statistic is lower than the LMI mean*, it is designated as **HIGH-LOW**. -->
<!-- * *If a Ward's LMI was found not to be significant*, the Ward will be mapped as **not significant**. -->
<!-- For example, this means that if we know our Ward’s observed value is less than the mean value of our overall `y6_obesity_2014 variable`, then it means it is of course a low value for obesity in comparison to the entirety of London. If it’s local Moran’s I statistic is also lower than the mean value of the rest of the LMI_Ii statistics, it also means it is located in a neighbourhood of low values. As a result, if this relationship is significant (determined by the pseudo $p$-value from our local Moran’s I calculation), we can call this a “LOW-LOW” cluster. -->
<!-- To achieve this cluster map, we need to take several additional steps: -->
<!-- * The first will tell us, for each Ward, whether its observed value is higher or lower than the mean observed. -->
<!-- * The second will tell us, for each Ward, whether its LMI value is higher or lower than the mean LMI. -->
<!-- * The third will use the values of these two columns to assign each Ward with a cluster type. -->
<!-- Determine the cluster type of each Ward by comparing observed and LMI values against their respective means and the significance value: -->
<!-- ```{r 07-LMI-cluster-type, warnings=FALSE, message=FALSE, cache=FALSE, tidy='styler'} -->
<!-- # compare local value for obesity with mean value -->
<!-- obesity_Ward_sdf <- obesity_Ward_sdf %>% mutate(obs_diff = (y6_obesity_2014 - mean(obesity_Ward_sdf$y6_obesity_2014))) -->
<!-- # compare local LMI value with mean LMI value -->
<!-- obesity_Ward_sdf <- obesity_Ward_sdf %>% mutate(LMI_diff = (obesity_LMI$LMI_Ii - mean(obesity_LMI$LMI_Ii))) -->
<!-- # set a significance threshold  -->
<!-- signif <- 0.05 -->
<!-- # generate column with cluster type, using values above -->
<!-- obesity_Ward_sdf <- obesity_Ward_sdf %>%  -->
<!--   mutate(cluster_type = case_when(obs_diff > 0 & LMI_diff > 0 & LMI_sigP < signif ~ "High-High", -->
<!--                                   obs_diff < 0 & LMI_diff < 0 & LMI_sigP < signif ~ "Low-Low", -->
<!--                                   obs_diff < 0 & LMI_diff > 0 & LMI_sigP < signif ~ "Low-High", -->
<!--                                   obs_diff > 0 & LMI_diff < 0 & LMI_sigP < signif ~ "High-Low", -->
<!--                                   LMI_sigP > signif ~ "No Significance")) -->
<!-- ``` -->
<!-- Now we have a column detailing our cluster types, we can create a cluster map that details our four cluster types as well as those that are not significant. Creating a categorical map in R and using `tmap` is a little tricky and we will need to do some preparing of our colour palettes to ensure our data is mapped correctly. To do this, we first need to figure out how many cluster types we have in our `cluster_type` field: -->
<!-- ```{r 07-LMI-cs, warnings=FALSE, message=FALSE, cache=TRUE, tidy=TRUE} -->
<!-- # count the different values within our `cluster_type` variable  -->
<!-- count(obesity_Ward_sdf, cluster_type) -->
<!-- ``` -->
<!-- We can see we actually have all four cluster types present within our dataset - alongside the `No Significance` value. We therefore need to ensure our palette includes four colours for these two cluster types, plus a white colour for `No Significance`: -->
<!-- ```{r 07-plot-LMI-hscs, warnings=FALSE, message=FALSE, cache=TRUE, tidy='styler'} -->
<!-- # create a colour palette -->
<!-- pal <- c("#d7191c", "#fdae61", "#abd9e9", "#2c7bb6","#F5F5F5") -->
<!-- # plot the clusters -->
<!-- tm_shape(obesity_Ward_sdf) + -->
<!--   tm_polygons(col = "cluster_type", palette = pal, title = "Cluster Type") + -->
<!--   tm_layout(main.title = "Cluster Map of Childhood Obesity in London, 2014", -->
<!--             main.title.fontface = 2, fontfamily = "Helvetica", legend.outside = TRUE, -->
<!--             legend.outside.position = "right", -->
<!--             legend.title.size = 1, -->
<!--             legend.title.fontface = 2) + -->
<!--   tm_compass(type = "arrow", position = c("right", "bottom")) + -->
<!--   tm_scale_bar(breaks = c(0, 5, 10, 15, 20), position = c("left", "bottom")) -->
<!-- ```  -->
<!-- And there we have it: within one map we can visualise both the relationship of our Wards to their respective neighbourhoods and the significance of this relationship from our local Moran's I test. This type of map is called a LISA map and is a great way of showing how a variable is actually clustering. -->
<!-- ### Getis-Ord-Gi* -->
<!-- The final test we will run today is the local Getis-Ord, which will produce the Gi* statistic. This statistic will identify hot- and coldspots by looking at the neighbours within a defined proximity to identify where either high or low values cluster spatially and recognising statistically significant hotspots as those areas of high values where other areas within a neighbourhood range also share high values too (and vice versa for coldspots). -->
<!-- Run the local Gi* statistic spatial autocorrelation test and print the result: -->
<!-- ```{r 07-local-GO, warnings=FALSE, message=FALSE, cache=TRUE, tidy=TRUE} -->
<!-- # run the local Gi* test on our y6_obesity_2014 data, note we again use the fd weights -->
<!-- obesity_LGO <- obesity_Ward_sdf %>% pull(y6_obesity_2014) %>% as.vector() %>% localG(., Ward_spatial_weights_fd)  -->
<!-- # join the local Gi* statistic to `obesity_Ward_sdf` spatial dataframe -->
<!-- obesity_Ward_sdf <- obesity_Ward_sdf %>% mutate(obesity_LGO_G = as.numeric(obesity_LGO)) -->
<!-- # inspect -->
<!-- obesity_Ward_sdf -->
<!-- ```  -->
<!-- By printing the results of our test, we can see that the local Getis-Ord test is a bit different from a local Moran's I test as it only contains a single value: the z-score. The z-score is a standardised value relating to whether high values or low values are clustering together, which we call the Gi* statistic. We can join this output, a list of our Gi* values, to our `obesity_Ward_sdf` spatial dataframe and map the result: -->
<!-- ```{r 07-join-local-GO, warnings=FALSE, message=FALSE, cache=TRUE, tidy=TRUE} -->
<!-- ``` -->
<!-- ```{r 07-map-local-GO, warnings=FALSE, message=FALSE, cache=TRUE, tidy='styler'} -->
<!-- # create a colour palette -->
<!-- GIColours <- rev(brewer.pal(8, "RdBu")) -->
<!-- # plot the clusters -->
<!-- tm_shape(obesity_Ward_sdf) +  -->
<!--   tm_polygons("obesity_LGO_G", style = "pretty", palette=GIColours, -->
<!--               midpoint=0, title = "Local Gi* statistic") + -->
<!--   tm_layout(main.title = 'Hot/Cold Spot Map of Childhood Obesity in London, 2014',  -->
<!--             main.title.fontface = 2, fontfamily = "Helvetica", -->
<!--             legend.outside = TRUE,  -->
<!--             legend.outside.position = "right",  -->
<!--             legend.title.size = 1,  -->
<!--             legend.title.fontface = 2) +  -->
<!--   tm_compass(type = "arrow", position = c("right", "bottom")) + -->
<!--   tm_scale_bar(breaks = c(0, 5, 10, 15, 20), position = c("left", "bottom")) -->
<!-- ```  -->
<!-- Our map shows quite clearly hot and cold spots of obesity across London. How does this compare with our local Moran's I? Do we see the same clusters? -->
<!-- :::tip -->
<!-- **Tip** <br/> -->
<!-- If we want to only map the statistically significant clusters, we need to use these [z-scores](https://en.wikipedia.org/wiki/Standard_score) to filter out only statistically significant clusters. When using a 95 percent confidence level your values should be between `-1.96` and `+1.96` standard deviations. -->
<!-- ::: -->
<!-- ## Assignment 2 {#assignment-2-w07} -->
<!-- Through conducting our spatial autocorrelation tests, we can visually confirm the presence of clusters in our `y6_obesity_2014` variable and provide a significance value associated with these tests. This provides us with a way to explain our distributions **quantitatively** during the analysis of our results. -->
<!-- Now you have the code, you will be able to repeat this analysis on any variable in the future. For this week's assignment, we therefore want you to find out whether our `IDACI_2010` variable contains spatial clustering. -->
<!-- In order to do this, you have to: -->
<!-- 1. Create a choropleth map showing the distribution of the variable values. -->
<!-- 2. Calculate a global spatial autocorrelation statistic and explain what it shows. -->
<!-- 3. Create a local Moran's I map showing the four cluster types. -->
<!-- 4. Create a local Getis-Ord hotspot map. -->
<!-- 5. Compare these results to the output of our `y6_obesity_2014` values. Do both variables have clusters? Do we see similar clusters in similar locations? What might this tell us about the relationship between deprivation and obesity in children in London? -->
<!-- 6. Run the analysis using a different neighbour definition. What happens? Do the results change? -->
</section>
</section>
<section id="wm-w07" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="wm-w07"><span class="header-section-number">7.7</span> Want more? [Optional]</h2>
<section id="more-spatial-autocorrelation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="more-spatial-autocorrelation">More spatial autocorrelation</h3>
<p>If you are interested in moving beyond spatial autocorrelation, for instance how to account for spatial autocorrelation in statistical models (e.g.&nbsp;with Geographically Weighted Regression or Spatial Regression), have a look at the workbook <a href="https://profrichharris.github.io/MandM/themap.html">Mapping and Modelling Geographic Data in R</a> by Bristol-based Professor <a href="https://www.bristol.ac.uk/people/person/Richard-Harris-871b21a9-0f5f-4bc8-9a99-8ace550d9903/">Richard Harris</a>. Start with <a href="https://profrichharris.github.io/MandM/themap.html">The Spatial Variable</a> section, move to the <a href="https://profrichharris.github.io/MandM/autocorrelation.html">Measuring spatial autocorrelation</a> section before looking at the <a href="https://profrichharris.github.io/MandM/gwstats.html">Geographically Weighted Statistics</a> and <a href="https://profrichharris.github.io/MandM/spregress.html">Spatial Regression</a> sections.</p>
</section>
</section>
<section id="byl-w07" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="byl-w07"><span class="header-section-number">7.8</span> Before you leave</h2>
<p>And that is how you can measure spatial dependence in your dataset through different spatial autocorrelation measures. Next week we will focus on the last topic within our set of core spatial analysis methods and techniques, but <a href="https://www.youtube.com/watch?v=fCZVL_8D048">this week we have covered enough</a>!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-operations.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Analysing Spatial Patterns I: Geometric Operations and Spatial Queries</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-data.html" class="pagination-link">
        <span class="nav-page-text">Data Sources</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Course material by <a href="https://www.mappingdutchman.com">Justin van Dijk</a>. Available under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>