<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOG0030</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-autocorrelation.html" rel="next">
<link href="./06-operations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="assets/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-operations.html">Core Spatial Analysis</a></li><li class="breadcrumb-item"><a href="./07-point-pattern.html">Analysing Spatial Patterns II: Point Pattern Analysis</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jtvandijk/GEOG0030" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Module overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Foundational Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 Geocomputation: An Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-GIScience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 GIScience and GIS software</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-cartography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 Cartography and Visualisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 Programming for Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Programming for Spatial Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Core Spatial Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 Analysing Spatial Patterns I: Geometric Operations and Spatial Queries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-point-pattern.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">7 Analysing Spatial Patterns II: Point Pattern Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-autocorrelation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 Analysing Spatial Patterns III: Spatial Autocorrelation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Advanced Spatial Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9 Rasters, Zonal Statistics, and Interpolation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Transport Network Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Additional Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Data Sources</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analysing-spatial-patterns-ii-point-pattern-analysis" id="toc-analysing-spatial-patterns-ii-point-pattern-analysis" class="nav-link active" data-scroll-target="#analysing-spatial-patterns-ii-point-pattern-analysis"><span class="header-section-number">7</span> Analysing Spatial Patterns II: Point Pattern Analysis</a>
  <ul class="collapse">
  <li><a href="#slides-w07" id="toc-slides-w07" class="nav-link" data-scroll-target="#slides-w07"><span class="header-section-number">7.1</span> Lecture slides</a></li>
  <li><a href="#reading-w07" id="toc-reading-w07" class="nav-link" data-scroll-target="#reading-w07"><span class="header-section-number">7.2</span> Reading list</a></li>
  <li><a href="#bike-theft-w07" id="toc-bike-theft-w07" class="nav-link" data-scroll-target="#bike-theft-w07"><span class="header-section-number">7.3</span> Bike theft in London II</a>
  <ul class="collapse">
  <li><a href="#setup-w07" id="toc-setup-w07" class="nav-link" data-scroll-target="#setup-w07"><span class="header-section-number">7.3.1</span> Getting started</a></li>
  <li><a href="#data-preparation-w07" id="toc-data-preparation-w07" class="nav-link" data-scroll-target="#data-preparation-w07"><span class="header-section-number">7.3.2</span> Data preparation</a></li>
  </ul></li>
  <li><a href="#point-pattern-analysis" id="toc-point-pattern-analysis" class="nav-link" data-scroll-target="#point-pattern-analysis"><span class="header-section-number">7.4</span> Point pattern analysis</a></li>
  <li><a href="#density-based-methods" id="toc-density-based-methods" class="nav-link" data-scroll-target="#density-based-methods"><span class="header-section-number">7.5</span> Density-based methods</a>
  <ul class="collapse">
  <li><a href="#quadrat-analysis" id="toc-quadrat-analysis" class="nav-link" data-scroll-target="#quadrat-analysis"><span class="header-section-number">7.5.1</span> Quadrat analysis</a></li>
  <li><a href="#kernel-density-estimation" id="toc-kernel-density-estimation" class="nav-link" data-scroll-target="#kernel-density-estimation"><span class="header-section-number">7.5.2</span> Kernel Density Estimation</a></li>
  </ul></li>
  <li><a href="#distance-based-methods" id="toc-distance-based-methods" class="nav-link" data-scroll-target="#distance-based-methods"><span class="header-section-number">7.6</span> Distance-based methods</a>
  <ul class="collapse">
  <li><a href="#average-nearest-neighbour" id="toc-average-nearest-neighbour" class="nav-link" data-scroll-target="#average-nearest-neighbour"><span class="header-section-number">7.6.1</span> Average Nearest Neighbour</a></li>
  <li><a href="#dbscan" id="toc-dbscan" class="nav-link" data-scroll-target="#dbscan"><span class="header-section-number">7.6.2</span> DBSCAN</a></li>
  </ul></li>
  <li><a href="#assignment-w07" id="toc-assignment-w07" class="nav-link" data-scroll-target="#assignment-w07"><span class="header-section-number">7.7</span> Assignment</a></li>
  <li><a href="#wm-w07" id="toc-wm-w07" class="nav-link" data-scroll-target="#wm-w07"><span class="header-section-number">7.8</span> Want more? [Optional]</a>
  <ul class="collapse">
  <li><a href="#reproducible-research" id="toc-reproducible-research" class="nav-link" data-scroll-target="#reproducible-research">Reproducible research</a></li>
  </ul></li>
  <li><a href="#byl-w07" id="toc-byl-w07" class="nav-link" data-scroll-target="#byl-w07"><span class="header-section-number">7.9</span> Before you leave</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jtvandijk/GEOG0030/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="analysing-spatial-patterns-ii-point-pattern-analysis" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">7</span> Analysing Spatial Patterns II: Point Pattern Analysis</h1>
<p>This week, we will be looking at Point Pattern Analysis. With point pattern analysis, we look to detect clusters or patterns across a set of points, including measuring density, dispersion and homogeneity in our point structures. There are several approaches to calculating and detecting these clusters and today we explore several of these techniques using our <a href="06-operations.html#bike-theft-w06">bike theft dataset from last week</a>.</p>
<section id="slides-w07" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="slides-w07"><span class="header-section-number">7.1</span> Lecture slides</h2>
<p>The slides for this week’s lecture can be downloaded here: <a href="https://github.com/jtvandijk/GEOG0030/tree/master/slides/w07-geo.pdf">[Link]</a></p>
</section>
<section id="reading-w07" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="reading-w07"><span class="header-section-number">7.2</span> Reading list</h2>
<section id="essential-readings" class="level4">
<h4 class="anchored" data-anchor-id="essential-readings">Essential readings</h4>
<ul>
<li>Arribas-Bel, D., Garcia-López, M.-À., Viladecans-Marsal, E. 2021. Building(s and) cities: Delineating urban areas with a machine learning algorithm. <em>Journal of Urban Economics</em> 125: 103217. <a href="https://doi.org/10.1016/j.jue.2019.103217">[Link]</a></li>
<li>Cheshire, J. and Longley, P. 2011. Identifying spatial concentrations of surnames. <em>International Journal of Geographical Information Science</em> 26(2), pp.309-325. <a href="https://doi.org/10.1080/13658816.2011.591291">[Link]</a></li>
<li>Longley, P. <em>et al.</em> 2015. Geographic Information Science &amp; systems, <strong>Chapter 12</strong>: <em>Geovisualization</em>. <a href="https://ucl.rl.talis.com/link?url=https%3A%2F%2Fapp.knovel.com%2Fhotlink%2Ftoc%2Fid%3AkpGISSE001%2Fgeographic-information-science%3Fkpromoter%3Dmarc&amp;sig=e437927b963cc591dcb65491eccdd3869cc31aef80e1443cb2ba12d8f3bb031a">[Link]</a></li>
</ul>
</section>
<section id="suggested-readings" class="level4">
<h4 class="anchored" data-anchor-id="suggested-readings">Suggested readings</h4>
<ul>
<li>Van Dijk, J. and Longley, P. 2020. Interactive display of surnames distributions in historic and contemporary Great Britain. <em>Journal of Maps</em> 16, pp.58-76. <a href="https://doi.org/10.1080/17445647.2020.1746418">[Link]</a></li>
<li>Shi, X. 2010. Selection of bandwidth type and adjustment side in kernel density estimation over inhomogeneous backgrounds. <em>International Journal of Geographical Information Science</em> 24(5), pp.643-660. <a href="https://doi.org/10.1080/13658810902950625">[Link]</a></li>
<li>Yin, P. 2020. <em>Kernels and density estimation</em>. The Geographic Information Science &amp; Technology Body of Knowledge. <a href="https://doi.org/10.22224/gistbok/2020.1.12">[Link]</a></li>
</ul>
</section>
</section>
<section id="bike-theft-w07" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="bike-theft-w07"><span class="header-section-number">7.3</span> Bike theft in London II</h2>
<p>This week, we again investigate bike theft in London in 2021 as we continue to look to confirm our very simple hypothesis: <em>that bike theft cluster in space.</em> This week, instead of looking at the distance of individual bike thefts from train stations, we will look to analyse the distribution of clusters and identify hotspots of bike theft.</p>
<section id="setup-w07" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="setup-w07"><span class="header-section-number">7.3.1</span> Getting started</h3>
<p>Open a new script within your GEOG0030 project and save this script as <code>wk7-bike-theft-ppa.r</code>. At the top of your script, add the following metadata:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-script-title_0d8b3295aaa3ed6090071a5c613e3ad9">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysing bike theft in London using point pattern analysis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Date: January 2024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>All of the geometric operations and spatial queries we will use are contained within the <code>sf</code> library. For our Point Pattern Analysis, we will be using the <code>spatstat</code> library (“spatial statistics”). The <code>spatstat</code> library contains the different Point Pattern Analysis techniques we will want to use in this practical. We will also need the <code>terra</code> library, which provides classes and functions to manipulate geographic (spatial) data in raster format. We will use this package briefly today, but look into it in more detail in <a href="09-raster.html">Week 9</a>. Lastly, you will also need to load the <code>dbscan</code> package. Now let us add all of the libraries we will be using today to the top of our script:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-load-libraries_e39a879cfb6bf2b658e878f6a8f90f12">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="data-preparation-w07" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="data-preparation-w07"><span class="header-section-number">7.3.2</span> Data preparation</h3>
<p>This week, we will continue to use the data we extracted from OpenStreetMap <a href="06-operations.html#data-preparation-w06">last week</a> as well as the 2021 bike theft data that we prepared. Let’s go ahead and load all of our data at once. We will also load the MSOA</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-load-all-files_48b62bd57ff766057b75fc02fc961d33">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our MSOA GeoPackage, create outline</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>msoa_london <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/raw/boundaries/MSOA2021_London.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MSOA2021_London' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0030/data/raw/boundaries/MSOA2021_London.gpkg' 
  using driver `GPKG'
Simple feature collection with 1002 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 503574.2 ymin: 155850.8 xmax: 561956.7 ymax: 200933.6
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>outline_london <span class="ot">&lt;-</span> msoa_london <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_union</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in OSM tube and trains stations</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>stations_london <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/data/LondonStations.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LondonStations' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0030/data/data/LondonStations.gpkg' 
  using driver `GPKG'
Simple feature collection with 608 features and 6 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 505078.2 ymin: 159027.2 xmax: 556185.7 ymax: 200138.6
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in bike theft</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bike_theft_london <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/data/LondonBikeTheft2021.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LondonBikeTheft2021' from data source 
  `/Users/justinvandijk/Library/CloudStorage/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0030/data/data/LondonBikeTheft2021.gpkg' 
  using driver `GPKG'
Simple feature collection with 20768 features and 0 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 458978.5 ymin: 99463.06 xmax: 559591.3 ymax: 300738.7
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
</div>
<p>Let’s create a quick map of our data to check it loaded correctly:</p>
<div class="cell" data-hash="07-point-pattern_cache/html/fig-07-check-data_c8aa8a7f71dfebf087e1bfb23ce9e301">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our London MSOAs</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(outline_london) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>() <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add bike crime as blue</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(bike_theft_london) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"blue"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add our stations as red</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(stations_london) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add a north arrow</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"arrow"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add a scale bar</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-check-data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-check-data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Quick plot to see whether all data loaded correctly.</figcaption>
</figure>
</div>
</div>
</div>
<p>Great - that looks familiar! This means we can move forward with our data analysis and theoretical content for this week.</p>
</section>
</section>
<section id="point-pattern-analysis" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="point-pattern-analysis"><span class="header-section-number">7.4</span> Point pattern analysis</h2>
<p>Point pattern analysis (PPA) studies the spatial distribution of points. PPA uses the <strong>density</strong>, <strong>dispersion</strong> and <strong>homogeneity</strong> in our point datasets to assess, quantify and characterise its distribution. Over the last fifty years, various methods and measurements have been developed to analyze, model, visualise, and interpret these properties of point patterns (<a href="https://gistbok.ucgis.org/bok-topics/point-pattern-analysis">Qiang et al, 2020</a>).</p>
<p>There are three main categories of PPA techniques:</p>
<ul>
<li><strong>Descriptive statistics</strong>: The use of descriptive statistics will provide a summary of the basic characteristics of a point pattern, such as its central tendency and dispersion. Descriptive statistics provide a simple way of visualising a dataset as a whole, from plotting the median or mean centre, or, often preferably, a standard deviational ellipse for those datasets that display a directional pattern.</li>
<li><strong>Density-based methods</strong>: Density-based methods focus on the <em>first-order</em> properties of a dataset, i.e.&nbsp;the variation in the individual locations of the points in the dataset across the area of interest, and will characterise our dataset’s distribution accordingly in terms of density.</li>
<li><strong>Distanced-based methods</strong>: Distanced-based methods focus on the <em>second-order</em> properties of a dataset, i.e.&nbsp;the interactions between points within our data and whether they appear to have influence on one another and form clusters, and will characterise our dataset’s distribution accordingly in terms of dispersion.</li>
</ul>
<p>The main library to use when it comes to point pattern analysis in R is the <code>spatstat</code> library, developed by Baddeley, Rubak and Turner since 2005. As their documentation states:</p>
<blockquote class="blockquote">
<p>“<em>Spatstat is a package for the statistical analysis of spatial data. Its main focus is the analysis of spatial patterns of points in two-dimensional space</em>”.</p>
</blockquote>
<div class="{callout-note}">
<p>According to the <a href="https://cran.r-project.org/web/packages/spatstat/vignettes/getstart.pdf">Get Started with <code>spatstat</code> documentation</a> <code>spatstat</code> supports a very wide range of popular techniques for statistical analysis for spatial point patterns, including:</p>
<ul>
<li>Kernel estimation of density/intensity<br>
</li>
<li>Quadrat counting and clustering indices</li>
<li>Detection of clustering using Ripley’s K-function</li>
<li>Model-fitting</li>
<li>Monte Carlo tests</li>
</ul>
<p>We will only cover a small amount of the functionality the package offers - it has almost 1,800 pages of documentation and over 1,000 functions, so it would be near impossible to cover everything even if we had a full module dedicated just to PPA.</p>
</div>
<p>Before we get started with our analysis, you need to know one critical piece of information in order to use <code>spatstat</code>: we need our data to be in the format of a <code>ppp</code> object. There are some spatial packages in R that require us to convert our data from an <code>sf</code> simple features object (e.g.&nbsp;for point data, a SpatialPoints object) into a different spatial object class. <code>spatstat</code> is one of them.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>ppp</code> format is specific to <code>spatstat</code>, but you may find it used in other spatial libraries. An object of the class <code>ppp</code> represents a two-dimensional point dataset within a pre-defined area, known as the <strong>window of observation</strong>, a class in its own right, known as <code>owin</code> in <code>spatstat</code>. We can either directly create a <code>ppp</code> object from a list of coordinates (as long as they are supplied with a window of observation) <strong>or</strong> convert from another data type.</p>
</div>
</div>
</div>
<p>Let’s turn our <code>bike_theft_london</code> dataframe into a <code>ppp</code> object:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-to-ppp_021182fd4c10904db0d6b6581e085518">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clip bike theft to the London outline</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>bike_theft_london <span class="ot">&lt;-</span> bike_theft_london <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_intersection</span>(outline_london)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sf to ppp</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>window <span class="ot">=</span> <span class="fu">as.owin</span>(outline_london)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>bike_theft_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="fu">st_coordinates</span>(bike_theft_london)[, <span class="dv">1</span>], <span class="fu">st_coordinates</span>(bike_theft_london)[,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>], <span class="at">window =</span> window)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike_theft_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-to-ppp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-to-ppp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Bike theft in London represented as <code>ppp</code> object.</figcaption>
</figure>
</div>
</div>
</div>
<p>Our plot shows us our <code>bike_theft_ppp</code> object, which includes both the coordinate points of our bike theft data and our observation window. You should also see your <code>bike_theft_ppp</code> object variable appear in your <strong>Environment</strong> window. You should also see a message stating that our data contains duplicated points.</p>
<p>One of the <strong>key assumptions</strong> underlying many analytical methods is that <strong>all events are unique</strong>. In fact, some statistical procedures actually may return very wrong results if duplicate points are found within the data. In terms of our bike theft data, it is likely that it contains duplicates. The Police service use <a href="https://data.police.uk/about/#anonymisation">snapping points</a>, to which crimes are snapped to in order to preserve the anonymity and privacy of those involved. This is an issue in spatial point pattern analysis as we need our <code>events</code>, i.e.&nbsp;each record of a theft and its respective location, to <strong>be unique</strong> in order for our analysis to be accurate. Let’s investigate by how many duplicated points we have:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-check-duplicates_ab3e47c9c1f977cf6a1a16e4accc79d8">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for any duplicates</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anyDuplicated</span>(bike_theft_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of duplicated points</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">multiplicity</span>(bike_theft_ppp) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13730</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>We clearly have a large number of duplicated points. To account for these issues within our dataset, we have three options:</p>
<ol type="1">
<li>We can remove the duplicates and pretend they simply are not there. However, this is feasible only when your research problem allows for this, i.e.&nbsp;the number of points at each location is not as important as the locations themselves or the number of duplicated points is incredibly small and will not affect any analysis.</li>
<li>Create and assign a weighting schema to our points, where each point will have an attribute that details the number of events that occur in that location and utilise this weight within our PPA techniques. Weights, however, can only be used with certain PPA techniques.</li>
<li>Force all points to be unique by utilising a function that offsets our points randomly from their current location. If the <strong>precise</strong> location is not important for your analysis or, for example, you are dealing with data that in our case is already slightly offset, we can introduce a “jitter” to our dataset that slightly adjusts all coordinates so that the event locations do not exactly coincide anymore.</li>
</ol>
</div>
</div>
</div>
<p>Each approach will have a specific compromise, which you will have to decide upon depending on the type of analysis you are completing. In our case, we will choose the jitter approach to keep all of our bike theft events. We know that already the location of our bike thefts are not precise locations of the original theft, therefore adding minimal (~5 metres) additional offset will not affect our analysis.</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-jitter-jitter-jitter_ae23e8361f55114644e194dcb329fafd">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add an offset to our points</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>bike_theft_ppp_jitter <span class="ot">&lt;-</span> <span class="fu">rjitter</span>(bike_theft_ppp, <span class="at">radius =</span> <span class="dv">5</span>, <span class="at">retry =</span> <span class="cn">TRUE</span>, <span class="at">nsim =</span> <span class="dv">1</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">drop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check for any duplicates</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anyDuplicated</span>(bike_theft_ppp_jitter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of duplicated points</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">multiplicity</span>(bike_theft_ppp_jitter) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Great, we now have our bike theft data in a format ready to be analysed with our different PPA techniques using the <code>spatstat</code> library.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>One additional thing to note about the <code>ppp</code> data object is that a <code>ppp</code> object does not necessarily have to have any attributes associated with the events each point our point data represents. If your data does have attributes, these attributes are referred to as <strong>marks</strong> within the <code>spatstat</code> environment. Be aware that some functions do require these marks to be present.</p>
</div>
</div>
</div>
</section>
<section id="density-based-methods" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="density-based-methods"><span class="header-section-number">7.5</span> Density-based methods</h2>
<p>Density-based techniques are used to characterise the pattern of a point dataset utilising its general distribution. We can calculate densities at both the <strong>global</strong> and <strong>local</strong> scale. However, global densities do not tell us much about the distribution of our data. This is where local density techniques such as <strong>Quadrat Analysis</strong> and <strong>Kernel Density Estimation</strong> can help us.</p>
<section id="quadrat-analysis" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="quadrat-analysis"><span class="header-section-number">7.5.1</span> Quadrat analysis</h3>
<p>We can create a simple understanding of our data’s distribution by first understanding its <strong>global density</strong>. This is simply the ratio of the observed number of points <span class="math inline">\((n\)</span> to the study region’s surface area <span class="math inline">\(a\)</span>:</p>
<p><span class="math display">\[\widehat{\lambda} =\frac{n}{a}\]</span></p>
<p>Calculate the global density of our bike theft point data relative to London:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-global-density_62457db1ab9b5e61b3b12ab537c7eca2">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># global density</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bike_theft_london<span class="sc">$</span>geom)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">st_area</span>(msoa_london)) <span class="sc">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.01304807 [1/m^2]</code></pre>
</div>
</div>
<p>We can see that we have a global density of ~13 bike thefts per square kilometre. This simple density analysis could be supported with further descriptive statistics, however, we still would know little about the local density of our points. The most basic approach to understanding a point layer’s local density is to simply measure the density at different locations within the study area. This approach helps us assess if the density is constant across the study area. The simplest approach to this measurement is through <strong>Quadrat Analysis</strong>, where the study area is divided into sub-regions. The point density is then computed for each quadrat, by dividing the number of points in each quadrat by the quadrat’s area.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Quadrats can take on many different shapes such as hexagons or rectangles. The standard approach, however, is a grid of squares The choice of quadrat numbers and quadrat shape can influence the measure of local density and therefore must be chosen with care.</p>
</div>
</div>
</div>
<p>We will start with a simple quadrat count by dividing the observation window into 10 x 10 sections and then counting the number of bicycle thefts:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-quadrat-count_d439775626b7d868fbd42911b60b026b">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratcount</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>biketheft_quadrat <span class="ot">&lt;-</span> <span class="fu">quadratcount</span>(bike_theft_ppp_jitter, <span class="at">nx =</span> <span class="dv">10</span>, <span class="at">ny =</span> <span class="dv">10</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(biketheft_quadrat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-quadrat-count" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-quadrat-count-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Quadratcount for our bike theft point dataset.</figcaption>
</figure>
</div>
</div>
</div>
<p>Our resulting quadrat count shows total counts of bike theft. We can see quite quickly that the quadrats in central London are likely to have a higher local density as their count is much higher than those on the outskirts of London. If we divided our count by the area covered by each quadrat, we would also be able to calculate a precise local density. We will not do this for now, as realistically quadrat analysis is not used very often. The reason why we look at this technique is that it provides us with an easy way to think about how to compare our data distribution and how this relates to the <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a> of Complete Spatial Randomness (CSR).</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>When looking at the distribution of our points and the respective patterns they show, the key question we often want to answer as geographers is: are our points clustered, randomly distributed, uniform or dispersed? Whilst we can visually assess this distribution, to be able to statistically quantify our data’s distribution, we can compare its distribution to that of the <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>. The Poisson distribution describes the probability or rate of an event happening over a fixed interval of time or space.</p>
<p>The Poisson Distribution can be used when:</p>
<ul>
<li>The events are discrete and can be counted in integers</li>
<li>Events are independent of one another</li>
<li>The average number of events over space or time is known</li>
</ul>
<p>Point data that contains a random distribution of points is said to follow a Poisson distribution. The Poisson distribution is very useful as it allows us to compare a random expected model to our observations. Essentially, if our data’s distribution does not fit the Poisson distribution, then we can infer that something interesting might be going on and our events might not actually be independent of each other. Instead, they might be clustered or dispersed and there is likely to be underlying processes influencing these patterns.</p>
</div>
</div>
</div>
<p>We can use a Poisson distribution to generate a randomly generated point pattern dataset with the same number of points and the same observation window. We then can compare our quadrat analysis with the theoretical quadrat analysis using a <a href="https://en.wikipedia.org/wiki/Chi-squared_test">chi-squared test</a>, with the null hypotheses that our point data are randomly distributed.</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-quadrat-test_2a20b0163023d03f4ea75240903e1168">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quadrat test</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quadrat.test</span>(bike_theft_ppp_jitter, <span class="at">nx =</span> <span class="dv">10</span>, <span class="at">ny =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Some expected counts are small; chi^2 approximation may be inaccurate</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test of CSR using quadrat counts

data:  bike_theft_ppp_jitter
X2 = 55584, df = 80, p-value &lt; 2.2e-16
alternative hypothesis: two.sided

Quadrats: 81 tiles (irregular windows)</code></pre>
</div>
</div>
<p>Our <span class="math inline">\(p\)</span> value is well below 0.01, which means there is a statistically significant difference between the expected random distribution as drawn from a Poisson distribution and the observed distribution.</p>
</section>
<section id="kernel-density-estimation" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="kernel-density-estimation"><span class="header-section-number">7.5.2</span> Kernel Density Estimation</h3>
<p>We now have a basic confirmation that our data is not randomly distributed. Instead of looking at the distribution of our bike theft with the boundaries of our quadrats, we can analyse our points using a <strong>Kernel Density Estimation (KDE)</strong>. KDE is a statistical technique to generate a smooth continuous distribution between data points that represent the density of the underlying pattern.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>A KDE will produce a raster surface that details the estimated distribution of our event point data over space. Each cell within our raster contains a value that is this estimated density at that location; when visualised in its entirety as the whole raster, we can quickly identify areas of high and low density, i.e.&nbsp;where are clusters are located in our dataset. To create this surface, a KDE computes a localised density for small subsets of our study area but unlike quadrat analysis, these subsets overlap one another to create a <em>moving</em> sub-region window, defined by a <strong>kernel</strong>. A kernel defines the shape and size of the window and can also weight the points, using a defined kernel function. The simplest kernel function is a basic kernel where each point in the kernel window is assigned equal weight. The kernel density approach generates a grid of density values whose cell size is smaller than that of the kernel window. Each cell is assigned the density value computed for the kernel window centered on that cell. The resulting surface is created from these individually, locally calculated density values.</p>
</div>
</div>
</div>
<p>Producing a KDE in R is very straight-forward in <code>spatstat</code>, using your <code>ppp</code> object and the <code>density.ppp()</code> function. However, you will need to consider both the <strong>bandwidth</strong> or diameter of your Kernel (<code>sigma</code>) and whether you want to apply a weighting to your points using a function. First, let’s go ahead and create a simple KDE of bike theft with our bandwidth set to 100m:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde100_4716e9efe77f35a79434647712aa4a35">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde100" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde100-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Kernel density estimation - bandwidth 100m.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see from just our KDE that there are visible clusters present within our bike theft data, particularly in and around central London. We can go ahead and vary our bandwidth to to see how that affects the density estimate:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde500_5da7ba5eceff39df2b7023088eeef37e">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde500" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde500-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Kernel density estimation - bandwidth 500m.</figcaption>
</figure>
</div>
</div>
</div>
<p>Our clusters now appear brighter and larger than our KDE with a 100m bandwidth. This is because changing the bandwidth enables your KDE to take into account more points within its calculation, resulting in a smoother surface. However, there are issues with oversmoothing your data - as you can see above, our clusters are not as well defined and therefore we may attribute high levels of bike theft to areas where there actually is not that much. Smaller bandwidths will lead to a more irregular shaped surface, where we have more precision in our defined clusters but, once again, there are issues of undersmoothing.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Whilst there are automated functions (e.g.&nbsp;based on maximum-likelihood estimations) that can help you with selecting an appropriate bandwidth, in the end you will have to make a decision on what is most appropriate for your dataset.</p>
</div>
</div>
</div>
<p>Although bandwidth typically has a more pronounced effect upon the density estimation than the type of kernel used, kernel types can affect the result too. When we use a different kernel type, we are looking to weight the points within our kernel differently:</p>
<div class="cell" data-hash="07-point-pattern_cache/html/fig-kernels_a6526373f7b9b33f927694745f6e54fe">
<div class="cell-output-display">
<div id="fig-kernels" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/w07/kerneltypes.png" class="img-fluid figure-img" width="375"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Kernel types and their distributions. <a href="https://jtvandijk.github.io/GEOG0030/images/w07/kerneltypes.png" target="_blank">[Enlarge image]</a></figcaption>
</figure>
</div>
</div>
</div>
<p>Each function will result in [a slightly different estimation. Deciding which function is most suitable for your analysis will all depend on what you are trying to capture. We can compare and see the impact of different functions on our current dataset looking at the default kernel in <code>density.ppp()</code>, which <em>gaussian</em>, alongside the <em>epanechnikov</em>, <em>quartic</em> or <em>disc</em> kernels.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>To change the kernel within your KDE, you simply need to add the <code>kernel</code> parameter and set it to one of the kernels available, denoted as a string, e.g.&nbsp;<em>epanechnikov</em>, <em>quartic</em>, <em>disc</em>. Ultimately, however, bandwidth will have a more marked effect upon the density estimation than kernel type.</p>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde500-gaussian_89173dd13c70a73955ef41af7fd7a798">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>, <span class="at">kernel =</span> <span class="st">"gaussian"</span>), <span class="at">main =</span> <span class="st">"Gaussian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde500-gaussian" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde500-gaussian-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Kernel density estimation - bandwidth 400m, Gaussian kernel.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde500-epanechnikov_e7ca7eeab7c7ab67cf2b2043472c5a32">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>, <span class="at">kernel =</span> <span class="st">"epanechnikov"</span>), <span class="at">main =</span> <span class="st">"Epanechnikov"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde500-epanechnikov" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde500-epanechnikov-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Kernel density estimation - bandwidth 400m, Epanechnikov kernel.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde500-quartic_76b6aeb3c71d406197a5e3f8f7bbd59a">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>, <span class="at">kernel =</span> <span class="st">"quartic"</span>), <span class="at">main =</span> <span class="st">"Quartic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde500-quartic" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde500-quartic-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Kernel density estimation - bandwidth 400m, Quartic kernel.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-bike-theft-kde500-disc_a9f337a2fb33d1e16cc08f80800ca9ef">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>, <span class="at">kernel =</span> <span class="st">"disc"</span>), <span class="at">main =</span> <span class="st">"Disc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-bike-theft-kde500-disc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-bike-theft-kde500-disc-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Kernel density estimation - bandwidth 400m, Disc kernel.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can be quite confident in stating that bike theft in London in 2021 is not a spatially random process and we can clearly see the areas where bicycle theft is most concentrated. How can we use this new data in our original analysis that looks to find out whether bike theft primarily occurs near tube and train stations? KDEs are primarily used for visual analysis of point data distribution. What we can do, however, is improve our visualisation and making it into a proper map using <code>tmap</code>.</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-to-raster_a31914a56c58634c2eaa359fbe82bd32">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to raster, clip by London outline</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>kde_400g_raster <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rast</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We now have a standalone raster we can use with any function in the <code>tmap</code> library. Before we go ahead, one issue we will face is that our resulting raster does not have a Coordinate Reference System, so we need to manually add this information to the raster object:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-to-raster-crs_b36567eec15e0de6fb62a81f7be66a80">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check CRS</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(kde_400g_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System: NA</code></pre>
</div>
</div>
<p>You should see an <code>NA</code> appear within our CRS arguments, so we need to fix this:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-to-raster-crs-set_d627ac1bbaf6c4c4e56e649330ef582b">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add CRS</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kde_400g_raster) <span class="ot">&lt;-</span> <span class="st">"epsg:27700"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check CRS</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(kde_400g_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: OSGB36 / British National Grid 
  wkt:
PROJCRS["OSGB36 / British National Grid",
    BASEGEOGCRS["OSGB36",
        DATUM["Ordnance Survey of Great Britain 1936",
            ELLIPSOID["Airy 1830",6377563.396,299.3249646,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4277]],
    CONVERSION["British National Grid",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",49,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-2,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996012717,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",400000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",-100000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["United Kingdom (UK) - offshore to boundary of UKCS within 49°45'N to 61°N and 9°W to 2°E; onshore Great Britain (England, Wales and Scotland). Isle of Man onshore."],
        BBOX[49.75,-9,61.01,2.01]],
    ID["EPSG",27700]]</code></pre>
</div>
</div>
<p>Now we have our raster data ready to map:</p>
<div class="cell" data-hash="07-point-pattern_cache/html/fig-kde-raster-map_105d1cd0f01662edbca0f03e0d20bf30">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map kde raster</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kde_400g_raster) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"lyr.1"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"Blues"</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-kde-raster-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-kde-raster-map-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Basic map using raster data using the <code>tmap</code> library.</figcaption>
</figure>
</div>
</div>
</div>
<p>With our <code>kde_400g_raster</code> using <code>tmap</code>, we can go ahead and customise our map as we would do with our vector mapping such as changing the legend, adding a title, north arrow, etc. — and, of course, our <code>stations_london</code> spatial layer.</p>
</section>
</section>
<section id="distance-based-methods" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="distance-based-methods"><span class="header-section-number">7.6</span> Distance-based methods</h2>
<p>We have spent a good amount of time looking at using density-based methods to quantify whether our point data is randomly distributed and visualise and identify high and low areas of density, showing if our data is clustered and where. <strong>Distance-based</strong> methods, on the other hands, allow us to quantify the second order properties of our data, i.e.&nbsp;the influence the location of these points have on one another.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Distance-based measures analyse the spatial distribution of points using distances between point pairs, with the majority using Euclidean distance, to determine quantitatively whether our data is, again, randomly distributed or shows sign of clustering or dispersion. These methods are a more rigorous alternative to using the Quadrat Analysis approach, and enables us to assess clustering within our point data at both a global and local scale. For the remainder of this practical, we look at one distance-based measure (<strong>average nearest neighbour</strong>) as well as a well-known hybrid technique (<strong>DBSCAN</strong>)</p>
</div>
</div>
</div>
<section id="average-nearest-neighbour" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="average-nearest-neighbour"><span class="header-section-number">7.6.1</span> Average Nearest Neighbour</h3>
<p>Average Nearest Neighbour (ANN) is the average distance between all points within a dataset and their individual nearest point. ANN is used as a global indicator to measure the overall pattern of a point set. The ANN of a given point collection can be compared with the expected ANN from points following a random distribution to test whether our point data is clustered or dispersed. The approach is similar to that of the Quadrat Analysis simulation we saw above, but by using distance rather than density grouped to arbitrary quadrats, ANN is likely to be a more robust quantification of our point distribution.</p>
<p>We can calculate the ANN for our dataset by using the <code>nndist()</code> function from the <code>spatstat</code> library:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-ann_95414b3ea84f26f32cdf208a07045b89">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average distance to nearest neighbour</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">nndist</span>(bike_theft_ppp_jitter, <span class="at">k =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53.42947</code></pre>
</div>
</div>
<p>We can see that the average nearest neighbour for all points is 53.5 metres. To get an insight into the spatial ordering of all our points relative to one another we can plot the ANN values for different order neighbours (i.e.&nbsp;first closest point, second closest point, etc. For point patterns that are highly clustered, we would expect the average distances between points to be very small.</p>
<p>Calculate the average nearest neighbour to the <span class="math inline">\(k\)</span> nearest neighbours for our bike theft data:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/fig-07-ann_7cc0ec8609ac88662fc5bf8ce544ce4a">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average distance to the nearest 100 neighbours</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>bike_theft_ann <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">nndist</span>(bike_theft_ppp_jitter, <span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>), <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike_theft_ann <span class="sc">~</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-ann" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-ann-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Average distances to the nearest 100 neighbours.</figcaption>
</figure>
</div>
</div>
</div>
<p>In our case, the plot does not reveal anything interesting in particular except that higher order points seem to be slightly closer than lower order points. Overall, the ANN is a good approach to conduct statistical tests on large datasets (e.g.&nbsp;if we were to compare the result to a theoretical distribution), but visually it does not tell us a huge amount about our dataset!</p>
</section>
<section id="dbscan" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="dbscan"><span class="header-section-number">7.6.2</span> DBSCAN</h3>
<p>The techniques above are useful exploratory techniques for telling us if we have spatial clusters present in our point data, but they are not able to tell us precisely <em>where</em> in our area of interest the clusters are occurring. One popular technique for discovering precise clusters in space is an algorithm known as <strong>DBSCAN</strong>, an algorithm that incorporates both distance and density.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For the complete overview of the DBSCAN algorithm, you can refer to the original paper by <a href="https://www.aaai.org/Papers/KDD/1996/KDD96-037.pdf">Ester <em>et al</em>. (1996)</a>. Whilst DBSCAN is a relatively old algorithm, there has been a substantial <a href="https://dl.acm.org/doi/10.1145/3068335">resurgence</a> in its use within spatial data science (e.g.&nbsp;see <a href="https://doi.org/10.1016/j.jue.2019.103217">Arribas-Bel <em>et al.</em> 2019</a>).</p>
</div>
</div>
</div>
<p>We can use DBSCAN to detect clusters within our bike theft dataset and then use the clusters to further answer our original research question. DBSCAN takes two parameters:</p>
<ul>
<li>The minimum number of points: <code>MinPts</code>.</li>
<li>The distance: <code>epsilon</code>.</li>
</ul>
<p>Across a set of points, DBSCAN will group together points that are close to each other based on a distance measurement and a minimum number of points. It also marks as outliers the points that are in low-density regions. The algorithm can be used to find associations and structures in data that are hard to find through visual observation alone, but that can be relevant and useful to find patterns and predict trends. However, DBSCAN will only work well if you are able to successfully define the distance and minimum points parameters and your clusters do not vary considerably in density.</p>
<p>We can conduct a DBSCAN analysis using the <code>dbscan</code> library. For our analysis, we will set our <code>epsilon</code> to 200m and then set our minimum cluster size to 20 bike thefts.</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-dbscan_3023db29a6c65bdab4d101cc052ca2c4">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run dbscan</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>bike_theft_dbscan <span class="ot">&lt;-</span> bike_theft_london <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_coordinates</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dbscan</span>(<span class="at">eps =</span> <span class="dv">200</span>, <span class="at">minPts =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The <code>dbscan()</code> function only accepts a data matrix or dataframe of points as input rather than a spatial dataframe. This is why in the above code we pass the <code>st_coordinates()</code> function to extract the projected coordinates.</p>
</div>
</div>
</div>
<p>The DBSCAN output contains three objects, including a vector detailing the cluster for each of our bike theft observations. To be able to work with our DBSCAN output effectively and, for example, plot the clusters as individual polygons, we need to add our cluster groups back to into our original point dataset. Because the DBSCAN output does not change the order of points, we can simply stick the cluster output on the <code>bike_theft_london</code> spatial dataframe.</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-dbscan-add-clusters_0d9235018550e8388e1ee16134a49209">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add the cluster numbers as column</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>bike_theft_london <span class="ot">&lt;-</span> bike_theft_london <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dbcluster =</span> bike_theft_dbscan<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Now we have each of our bike theft points in London associated with a specific cluster, we can generate a polygon that represents these clusters in space, as we can sort of see in our above plot. To do so, we will utilise a geometric operation from the <code>sf</code> package: the <code>st_convex_hull()</code> function. The <code>st_convex_hull()</code> function can be used to create a polygon that represents the minimum coverage of our individual clusters. We can use this function to create a polygon that represents the geometry of all points within each cluster. To enable this, we will use something called a <code>for</code> loop. A <code>for</code> loop is used to repeat a specific block of code a known number of times.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The code below is a bit complex, but essentially we repeat the following steps for each cluster that the DBSCAN algorithm identified:</p>
<ul>
<li>Filter the <code>bike_theft_london</code> spatial dataframe by cluster number.</li>
<li>Combine all points belonging to the same cluster into a single set of geometry observations.</li>
<li>Calculate the convex hull of that single set of geometry observations.</li>
<li>Store the resulting polygon in a list.</li>
</ul>
<p>Once we have looped through all clusters, we end up with a final list containing all the geometries of our cluster polygons which we can convert into a spatial dataframe.</p>
</div>
</div>
</div>
<p>Run a <code>for</code> loop to generate a polygon dataset that represents our bike theft clusters:</p>
<div class="cell styled-output" data-hash="07-point-pattern_cache/html/07-dbscan-for-loop_0fed4942fdfd700d56cb11741238550f">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty list to store the resulting convex hull geometries set the</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># length of this list to the total number of clusters found</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>geometry_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">max</span>(bike_theft_london<span class="sc">$</span>dbcluster))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a counter to keep track</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># begin loop</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (cluster_index <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(bike_theft_london<span class="sc">$</span>dbcluster))) {</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter to only return points for belonging to cluster n</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    biketheft_cluster_subset <span class="ot">&lt;-</span> bike_theft_london <span class="sc">|&gt;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(dbcluster <span class="sc">==</span> cluster_index)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># union points, calculate convex hull</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    cluster_polygon <span class="ot">&lt;-</span> biketheft_cluster_subset <span class="sc">|&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">st_union</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">st_convex_hull</span>()</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add the geometry of the polygon to our list</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    geometry_list[counter] <span class="ot">&lt;-</span> (cluster_polygon)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update the counter</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the list</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>bike_theft_clusters <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(geometry_list, <span class="at">crs =</span> <span class="dv">27700</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We now have a polygon spatial dataframe, <code>bike_theft_clusters</code>, that show the general location and distribution of bike theft clusters in London. Let’s put them on a map:</p>
<div class="cell" data-hash="07-point-pattern_cache/html/fig-07-map-clusters_33b22f7d2852dc1bfdb23fba46e9b380">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R code</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add London outline</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(outline_london) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add bike theft clusters</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(bike_theft_clusters) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add basemap</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_basemap</span>(<span class="fu">c</span>(<span class="at">StreetMap =</span> <span class="st">"OpenStreetMap"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div id="fig-07-map-clusters" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="07-point-pattern_files/figure-html/fig-07-map-clusters-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Basic map of identified DBSCAN bike theft clusters.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="assignment-w07" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="assignment-w07"><span class="header-section-number">7.7</span> Assignment</h2>
<p>We have conducted a lot of analysis today. What we have failed to do, however, is to make proper maps. For this week’s assignment, create two publishable maps with all the trimmings using the main outputs from today’s tutorial:</p>
<ol type="1">
<li>A Kernel Density Map of bike theft in London.</li>
<li>A cluster map of bike theft in London, using the DBSCAN output.</li>
</ol>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<ul>
<li>Because the thefts concentrate in central London why not consider zooming into a specific area?</li>
<li>Why not contextualise the densities and clusters by including the <code>stations_london</code> layer?</li>
</ul>
</div>
</div>
</div>
</section>
<section id="wm-w07" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="wm-w07"><span class="header-section-number">7.8</span> Want more? [Optional]</h2>
<section id="reproducible-research" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reproducible-research">Reproducible research</h3>
<p>Last week you might have had a look at the book <a href="https://psyteachr.github.io/reprores-v3/index.html">Data Skills for Reproducible Research</a>. A great tool that can be used to create reproducible workflows is found in the <code>targets</code> package. The targets package is a <a href="https://www.gnu.org/software/make/">Make</a>-like pipeline tool for Statistics and data science in R. With targets, you can maintain a reproducible workflow without repeating yourself. To get started: have a look at the <a href="https://books.ropensci.org/targets/walkthrough.html">Walkthrough</a> chapter to see <code>targets</code> in action.</p>
</section>
</section>
<section id="byl-w07" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="byl-w07"><span class="header-section-number">7.9</span> Before you leave</h2>
<p>As geographers we are keen to understand our point data’s distribution and understand whether are our points clustered, randomly distributed, uniform or dispersed. We have looked at various techniques that enable us to statistically and visually assess our data’s distribution and understand whether our data is randomly distributed or clustered in space. And that is <a href="https://www.youtube.com/watch?v=-zxtbwGogyY">us done for this week</a>. Reading list anyone?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-operations.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Analysing Spatial Patterns I: Geometric Operations and Spatial Queries</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-autocorrelation.html" class="pagination-link">
        <span class="nav-page-text">Analysing Spatial Patterns III: Spatial Autocorrelation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Course material by <a href="https://www.mappingdutchman.com">Justin van Dijk</a>. Available under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>